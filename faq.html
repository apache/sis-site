<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Frequently asked questions</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="http://www.apache.org/css/code.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/sis.css">

    

    
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License.  You may obtain a copy of the License at . http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the specific language governing permissions and limitations under the License. -->
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/index.html"> Apache SIS&trade;</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org/licenses/">License</a></li>
                  <li><a href="mail-lists.html">Mailing Lists</a></li>
                  <li><a href="team-list.html">Project Team</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="book/index.html">Developer guide</a></li>
                  <li><a href="apidocs/index.html">Online Javadoc</a></li>
                  <li><a href="downloads.html">Downloads</a></li>
                  <li><a href="source.html">Source Code</a></li>
                  <li><a href="code-patterns.html">Code patterns</a></li>
                  <li><a href="faq.html">FAQ</a></li>
                  <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org">The Foundation</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!-- /.nav-collapse -->
        </div><!-- /.container -->
      </div><!-- /.navbar-inner -->
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <div class="apache-con">
            <a href="https://www.apache.org/events/current-event.html">
              <img src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
            </a>
          </div>
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="active"><a href="index.html">Home</a></li>
              <li><a href="http://www.apache.org/licenses/">License</a></li>
              <li><a href="mail-lists.html">Mailing Lists</a></li>
              <li><a href="team-list.html">Project Team</a></li>
              <li class="nav-header">Project Documentation</li>
              <li><a href="book/index.html">Developer guide</a></li>
              <li><a href="apidocs/index.html">Online Javadoc</a></li>
              <li><a href="downloads.html">Downloads</a></li>
              <li><a href="source.html">Source Code</a></li>
              <li><a href="code-patterns.html">Code patterns</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
              <li class="nav-header">ASF</li>
              <li><a href="http://www.apache.org">The Foundation</a></li>
              <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
              <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="http://www.apache.org/security/">Security</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span10">
          <section id="content" class="row">
            <article class="span12">
              <img src="img/logo.png" class="sis-logo" align="left"/>
              <p class="page-title">Frequently asked questions</p>
              <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>This page lists some Frequently Asked Questions (FAQ) when using Apache SIS.
This FAQ is also <a href="faq_fr.html">available in French</a>.</p>
<div class="toc">
<ul>
<li><a href="#referencing">Referencing</a><ul>
<li><a href="#referencing-intro">Getting started</a><ul>
<li><a href="#transform-point">How do I transform a coordinate?</a></li>
<li><a href="#operation-methods">Which map projections are supported?</a></li>
<li><a href="#axisOrder">What is the axis order issue and how is it addressed?</a></li>
</ul>
</li>
<li><a href="#crs">Coordinate Reference Systems</a><ul>
<li><a href="#UTM">How do I instantiate a Universal Transverse Mercator (UTM) projection?</a></li>
<li><a href="#google">How do I instantiate a Google projection?</a></li>
<li><a href="#projectionKind">How can I identify the projection kind of a CRS?</a></li>
<li><a href="#lookupEPSG">How do I get the EPSG code of an existing CRS?</a></li>
<li><a href="#lookupURN">How do I get the "urn:ogc:def:crs:…" URN of an existing CRS?</a></li>
<li><a href="#lookupReliability">Can I rely on IdentifiedObjects.lookupEPSG(…) to work correctly as the inverse of CRS.forCode(…)?</a></li>
<li><a href="#equalsIgnoreMetadata">How can I determine if two CRS are "functionally" equal?</a></li>
<li><a href="#crsHashCode">Are CRS objects safe for use as keys in HashMap?</a></li>
</ul>
</li>
<li><a href="#transforms">Coordinate transformations</a><ul>
<li><a href="#axisOrderInTransforms">My transformed coordinates are totally wrong!</a></li>
<li><a href="#projectionName">I have correct axis order but my transformed coordinates are still wrong.</a></li>
<li><a href="#parameterUnits">I just used the WKT of a well-known authority and my transformed coordinates are still wrong!</a></li>
<li><a href="#BursaWolf">I verified all the above and still have an error of about one kilometer.</a></li>
<li><a href="#slightDifferences">I get slightly different results depending on the environment I’m running in.</a></li>
<li><a href="#toWGS84">Can I always expect a transform from an arbitrary CRS to WGS84 to succeed?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#metadata">Metadata</a><ul>
<li><a href="#metadata-implementation">Custom implementations</a><ul>
<li><a href="#metadata-proxy">My metadata are stored in a database-like framework. Implementing every GeoAPI interfaces for them is impractical.</a></li>
<li><a href="#metadata-unknownClass">I can not marshall my custom implementation.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="referencing">Referencing<a class="headerlink" href="#referencing" title="Permanent link">&para;</a></h1>
<h2 id="referencing-intro">Getting started<a class="headerlink" href="#referencing-intro" title="Permanent link">&para;</a></h2>
<h3 id="transform-point">How do I transform a coordinate?<a class="headerlink" href="#transform-point" title="Permanent link">&para;</a></h3>
<p>The following Java code projects a geographic coordinate from the <em>World Geodetic System 1984</em> (WGS84) to <em>WGS 84 / UTM zone 33N</em>.
In order to make the example a little bit simpler, this code uses predefined constants given by the <code>CommonCRS</code> convenience class.
But more advanced applications will typically use EPSG codes instead.
Note that all geographic coordinates below express latitude <em>before</em> longitude.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">org.opengis.geometry.DirectPosition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.opengis.referencing.crs.CoordinateReferenceSystem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.opengis.referencing.operation.CoordinateOperation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.opengis.referencing.operation.TransformException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.opengis.util.FactoryException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sis.referencing.CRS</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sis.referencing.CommonCRS</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sis.geometry.DirectPosition2D</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApp</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">FactoryException</span><span class="o">,</span> <span class="n">TransformException</span> <span class="o">{</span>
        <span class="n">CoordinateReferenceSystem</span> <span class="n">sourceCRS</span> <span class="o">=</span> <span class="n">CommonCRS</span><span class="o">.</span><span class="na">WGS84</span><span class="o">.</span><span class="na">geographic</span><span class="o">();</span>
        <span class="n">CoordinateReferenceSystem</span> <span class="n">targetCRS</span> <span class="o">=</span> <span class="n">CommonCRS</span><span class="o">.</span><span class="na">WGS84</span><span class="o">.</span><span class="na">universal</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">14</span><span class="o">);</span>  <span class="c1">// Get whatever zone is valid for 14°E.</span>
        <span class="n">CoordinateOperation</span> <span class="n">operation</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="na">findOperation</span><span class="o">(</span><span class="n">sourceCRS</span><span class="o">,</span> <span class="n">targetCRS</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

        <span class="c1">// The above lines are costly and should be performed only once before to project many points.</span>
        <span class="c1">// In this example, the operation that we got is valid for coordinates in geographic area from</span>
        <span class="c1">// 12°E to 18°E (UTM zone 33) and 0°N to 84°N.</span>

        <span class="n">DirectPosition</span> <span class="n">ptSrc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DirectPosition2D</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">14</span><span class="o">);</span>           <span class="c1">// 40°N 14°E</span>
        <span class="n">DirectPosition</span> <span class="n">ptDst</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="na">getMathTransform</span><span class="o">().</span><span class="na">transform</span><span class="o">(</span><span class="n">ptSrc</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Source: &quot;</span> <span class="o">+</span> <span class="n">ptSrc</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Target: &quot;</span> <span class="o">+</span> <span class="n">ptDst</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="operation-methods">Which map projections are supported?<a class="headerlink" href="#operation-methods" title="Permanent link">&para;</a></h3>
<p>The operation <em>methods</em> (including, but not limited to, map projections) supported by Apache SIS
are listed in the <a href="tables/CoordinateOperationMethods.html">Coordinate Operation Methods</a> page.
The amount of map projection methods is relatively small,
but the amount of <em>projected <abbr title="Coordinate Reference System">CRS</abbr></em> that we can build from them can be very large.
For example with only three family of methods (<em>Cylindrical Mercator</em>, <em>Transverse Mercator</em> and <em>Lambert Conic Conformal</em>)
used with different parameter values, we can cover thousands of projected <abbr title="Coordinate Reference System">CRS</abbr> listed in the EPSG geodetic dataset.</p>
<p>In order to use a map projection method, we need to know the value to assign to the projection parameters.
For convenience, thousands of projected <abbr title="Coordinate Reference System">CRS</abbr> with pre-defined parameter values are are assigned a unique identifier.
A well-known source of such definitions is the EPSG geodetic dataset, but other authorities also exist.
The predefined <abbr title="Coordinate Reference System">CRS</abbr> known to Apache SIS are listed in the
<a href="tables/CoordinateReferenceSystems.html">Coordinate Reference Systems</a> page.</p>
<h3 id="axisOrder">What is the axis order issue and how is it addressed?<a class="headerlink" href="#axisOrder" title="Permanent link">&para;</a></h3>
<p>The axis order is specified by the authority (typically a national agency) defining the Coordinate Reference System (<abbr title="Coordinate Reference System">CRS</abbr>).
The order depends on the <abbr title="Coordinate Reference System">CRS</abbr> type and the country defining the <abbr title="Coordinate Reference System">CRS</abbr>.
In the case of geographic <abbr title="Coordinate Reference System">CRS</abbr>, the (<em>latitude</em>, <em>longitude</em>) axis order is widely used by geographers and pilots for centuries.
However software developers tend to consistently use the (<em>x</em>, <em>y</em>) order for every kind of <abbr title="Coordinate Reference System">CRS</abbr>.
Those different practices resulted in contradictory definitions of axis order for almost every <abbr title="Coordinate Reference System">CRS</abbr> of kind <code>GeographicCRS</code>,
for some <code>ProjectedCRS</code> in the South hemisphere (South Africa, Australia, <em>etc.</em>) and for some polar projections among others.</p>
<p>For any <abbr title="Coordinate Reference System">CRS</abbr> identified by an EPSG code, the official axis order can be checked on the
official EPSG registry at <a href="http://www.epsg-registry.org">http://www.epsg-registry.org</a>
(not to be confused with other sites having "epsg" in their name,
but actually unrelated to the organization in charge of EPSG definitions):
click on the <em>"Retrieve by code"</em> link and enter the numerical code.
Then click on the <em>"View"</em> link on the right side,
and click on the <em>"+"</em> symbol of the left side of <em>"Axes"</em>.</p>
<p>Recent <abbr title="Open Geospatial Consortium">OGC</abbr> standards mandate the use of axis order as defined by the authority.
Oldest <abbr title="Open Geospatial Consortium">OGC</abbr> standards used the (<em>x</em>, <em>y</em>) axis order instead, ignoring any authority specification.
Among the legacy <abbr title="Open Geospatial Consortium">OGC</abbr> standards that used the non-conform axis order,
an influent one is version 1 of the <em>Well Known Text</em> (WKT) format specification.
According that widely-used format, WKT definitions without explicit <code>AXIS[…]</code> elements
shall default to (<em>longitude</em>, <em>latitude</em>) or (<em>x</em>, <em>y</em>) axis order.
In version 2 of the WKT format, <code>AXIS[…]</code> elements are no longer optional
and should contain an explicit <code>ORDER[…]</code> sub-element for making the intended order yet more obvious.</p>
<p>Many software products still use the old (<em>x</em>, <em>y</em>) axis order, sometime because it is easier to implement.
But Apache SIS rather defaults to axis order <em>as defined by the authority</em> (except when parsing a WKT 1 definition),
but allows changing axis order to the (<em>x</em>, <em>y</em>) order after <abbr title="Coordinate Reference System">CRS</abbr> creation.
This change can be done with the following code:</p>
<div class="codehilite"><pre><span class="n">CoordinateReferenceSystem</span> <span class="n">crs</span> <span class="o">=</span> <span class="err">…</span><span class="o">;</span>             <span class="c1">// CRS obtained by any means.</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">AbstractCRS</span><span class="o">.</span><span class="na">castOrCopy</span><span class="o">(</span><span class="n">crs</span><span class="o">).</span><span class="na">forConvention</span><span class="o">(</span><span class="n">AxesConvention</span><span class="o">.</span><span class="na">RIGHT_HANDED</span><span class="o">)</span>
</pre></div>


<h2 id="crs">Coordinate Reference Systems<a class="headerlink" href="#crs" title="Permanent link">&para;</a></h2>
<h3 id="UTM">How do I instantiate a Universal Transverse Mercator (UTM) projection?<a class="headerlink" href="#UTM" title="Permanent link">&para;</a></h3>
<p>If the UTM zone is unknown, an easy way is to invoke the <code>universal(…)</code> method on one of the <code>CommonCRS</code> pre-defined constants.
That method receives in argument a geographic coordinate in (<em>latitude</em>, <em>longitude</em>) order and computes the UTM zone from it.
See the <a href="#transform-point">above Java code example</a>.</p>
<p>If the UTM zone is know, one way is to use the "EPSG" or "AUTO" authority factory.
The EPSG code of some UTM projections can be determined as below, where <em>zone</em> is a number from 1 to 60 inclusive (unless otherwise specified):</p>
<ul>
<li>WGS 84 (northern hemisphere): 32600 + <em>zone</em></li>
<li>WGS 84 (southern hemisphere): 32700 + <em>zone</em></li>
<li>WGS 72 (northern hemisphere): 32200 + <em>zone</em></li>
<li>WGS 72 (southern hemisphere): 32300 + <em>zone</em></li>
<li>NAD 83 (northern hemisphere): 26900 + <em>zone</em> (zone 1 to 23 only)</li>
<li>NAD 27 (northern hemisphere): 26700 + <em>zone</em> (zone 1 to 22 only)</li>
</ul>
<p>Note that the above list is incomplete. See the EPSG database for additional UTM definitions
(WGS 72BE, SIRGAS 2000, SIRGAS 1995, SAD 69, ETRS 89, <em>etc.</em>, most of them defined only for a few zones).
Once the EPSG code of the UTM projection has been determined, the <abbr title="Coordinate Reference System">CRS</abbr> can be obtained as in the example below:</p>
<div class="codehilite"><pre><span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="mi">32600</span> <span class="o">+</span> <span class="n">zone</span><span class="o">;</span>    <span class="c1">// For WGS84 northern hemisphere</span>
<span class="n">CoordinateReferenceSystem</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="na">forCode</span><span class="o">(</span><span class="s">&quot;EPSG:&quot;</span> <span class="o">+</span> <span class="n">code</span><span class="o">);</span>
</pre></div>


<h3 id="google">How do I instantiate a Google projection?<a class="headerlink" href="#google" title="Permanent link">&para;</a></h3>
<p>The Google projection is a Mercator projection that pretends to be defined on the WGS84 datum,
but actually ignores the ellipsoidal nature of that datum and uses the simpler spherical formulas instead.
Since version 6.15 of EPSG geodetic dataset, the preferred way to get that projection is to invoke <code>CRS.forCode("EPSG:3857")</code>.
Note that the use of that projection is <strong>not</strong> recommended, unless needed for compatibility with other data.</p>
<p>The EPSG:3857 definition uses a map projection method named <em>"Popular Visualisation Pseudo Mercator"</em>.
The EPSG geodetic dataset provides also some other map projections that use spherical formulas.
Those methods have "(Spherical)" in their name, for example <em>"Mercator (Spherical)"</em>
(which differs from <em>"Popular Visualisation Pseudo Mercator"</em> by the use of a more appropriate sphere radius).
Those projection methods can be used in Well Known Text (WKT) definitions.</p>
<p>If there is a need to use spherical formulas with a projection that does not have a "(Spherical)" counterpart,
this can be done with explicit declarations of <code>"semi_major"</code> and <code>"semi_minor"</code> parameter values in the WKT definition.
Those parameter values are usually inferred from the datum, but Apache SIS allows explicit declarations to override the inferred values.</p>
<h3 id="projectionKind">How can I identify the projection kind of a <abbr title="Coordinate Reference System">CRS</abbr>?<a class="headerlink" href="#projectionKind" title="Permanent link">&para;</a></h3>
<p>The "kind of projection" (Mercator, Lambert Conformal, <em>etc.</em>) is called <em>Operation Method</em> in <abbr title="International Organization for Standardization">ISO</abbr> 19111 terminology.
One approach is to check the value of <code>OperationMethod.getName()</code> and compare them against the <abbr title="Open Geospatial Consortium">OGC</abbr> or EPSG names
listed in the <a href="tables/CoordinateOperationMethods.html">Coordinate Operation Methods</a> page.</p>
<h3 id="lookupEPSG">How do I get the EPSG code of an existing <abbr title="Coordinate Reference System">CRS</abbr>?<a class="headerlink" href="#lookupEPSG" title="Permanent link">&para;</a></h3>
<p>The <em>identifier</em> of a Coordinate Reference System (<abbr title="Coordinate Reference System">CRS</abbr>) object can be obtained by the <code>getIdentifiers()</code> method,
which usually return a collection of zero or one element.
If the <abbr title="Coordinate Reference System">CRS</abbr> has been created from a Well Known Text (WKT) parsing
and the WKT ends with an <code>AUTHORITY["EPSG", "xxxx"]</code> (WKT version 1) or <code>ID["EPSG", xxxx]</code> (WKT version 2) element,
then the identifier (an EPSG numerical code in this example) is the <em>xxxx</em> value in that element.
If the <abbr title="Coordinate Reference System">CRS</abbr> has been created from the EPSG geodetic dataset (for example by a call to <code>CRS.forCode("EPSG:xxxx")</code>),
then the identifier is the <em>xxxx</em> code given to that method.
If the <abbr title="Coordinate Reference System">CRS</abbr> has been created in another way, then the collection returned by the <code>getIdentifiers()</code> method
may or may not be empty depending if the program that created the <abbr title="Coordinate Reference System">CRS</abbr> took the responsibility of providing identifiers.</p>
<p>If the collection of identifiers is empty, the most effective fix is to make sure that the WKT
contains an <code>AUTHORITY</code> or <code>ID</code> element (assuming that the <abbr title="Coordinate Reference System">CRS</abbr> was parsed from a WKT).
If this is not possible, then the <code>org.​apache.​sis.​referencing.​IdentifiedObjects</code> class contains some convenience methods which may help.
In the following example, the call to <code>lookupEPSG(…)</code> will scan the EPSG database for a <abbr title="Coordinate Reference System">CRS</abbr> equals
(ignoring metadata) to the given one. <em>Note that this scan is sensitive to axis order.</em>
Most geographic <abbr title="Coordinate Reference System">CRS</abbr> in the EPSG database are declared with (<em>latitude</em>, <em>longitude</em>) axis order.
Consequently if the given <abbr title="Coordinate Reference System">CRS</abbr> has (<em>longitude</em>, <em>latitude</em>) axis order, then the scan is likely to find no match.</p>
<div class="codehilite"><pre><span class="n">CoordinateReferenceSystem</span> <span class="n">myCRS</span> <span class="o">=</span> <span class="err">…</span><span class="o">;</span>
<span class="n">Integer</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">IdentifiedObjects</span><span class="o">.</span><span class="na">lookupEPSG</span><span class="o">(</span><span class="n">myCRS</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">identifier</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;The EPSG code has been found: &quot;</span> <span class="o">+</span> <span class="n">identifier</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<h3 id="lookupURN">How do I get the "urn:ogc:def:crs:…" URN of an existing <abbr title="Coordinate Reference System">CRS</abbr>?<a class="headerlink" href="#lookupURN" title="Permanent link">&para;</a></h3>
<p><abbr title="Open Geospatial Consortium">OGC</abbr> defines URN for <abbr title="Coordinate Reference System">CRS</abbr> identifiers, for example <code>"urn:​ogc:​def:​crs:​epsg:​7.1:​4326"</code>
where <code>"7.1"</code> is the version of the EPSG database used.
URN may or may not be present in the set of identifiers returned by <code>crs.getIdentifiers()</code>.
In many cases (especially if the <abbr title="Coordinate Reference System">CRS</abbr> was parsed from a Well Known Text), only simple identifiers like <code>"EPSG:​4326"</code> are provided.
An easy way to build the full URN is to use the code below.
That example may scan the EPSG database for finding the information if it was not explicitely provided in the given <abbr title="Coordinate Reference System">CRS</abbr>.</p>
<div class="codehilite"><pre><span class="n">CoordinateReferenceSystem</span> <span class="n">myCRS</span> <span class="o">=</span> <span class="err">…</span><span class="o">;</span>
<span class="n">String</span> <span class="n">urn</span> <span class="o">=</span> <span class="n">IdentifiedObjects</span><span class="o">.</span><span class="na">lookupURN</span><span class="o">(</span><span class="n">myCRS</span><span class="o">);</span>
</pre></div>


<h3 id="lookupReliability">Can I rely on IdentifiedObjects.lookupEPSG(…) to work correctly as the inverse of <abbr title="Coordinate Reference System">CRS</abbr>.forCode(…)?<a class="headerlink" href="#lookupReliability" title="Permanent link">&para;</a></h3>
<p>For <abbr title="Coordinate Reference System">CRS</abbr> created from the EPSG geodetic dataset, usually yes.
Note however that <code>IdentifiedObjects.getIdentifier(…)</code> is cheaper and insensitive to the details of <abbr title="Coordinate Reference System">CRS</abbr> definition,
since it never query the database. But it works only if the <abbr title="Coordinate Reference System">CRS</abbr> declares explicitly its code,
which is the case for <abbr title="Coordinate Reference System">CRS</abbr> created from the EPSG database or parsed from a Well Known Text (WKT) having an <code>AUTHORITY</code> or <code>ID</code> element.
The <code>lookupEPSG(…)</code> method on the other hand is robust to erroneous code declaration,
since it always compares the <abbr title="Coordinate Reference System">CRS</abbr> with the database content.
But it may fail if there is slight mismatch (for example rounding errors in projection parameters)
between the supplied <abbr title="Coordinate Reference System">CRS</abbr> and the <abbr title="Coordinate Reference System">CRS</abbr> found in the database.</p>
<h3 id="equalsIgnoreMetadata">How can I determine if two <abbr title="Coordinate Reference System">CRS</abbr> are "functionally" equal?<a class="headerlink" href="#equalsIgnoreMetadata" title="Permanent link">&para;</a></h3>
<p>Two Coordinate Reference Systems may not be considered equal if they are associated to different metadata
(name, identifiers, scope, domain of validity, remarks), even though they represent the same logical <abbr title="Coordinate Reference System">CRS</abbr>.
In order to test if two <abbr title="Coordinate Reference System">CRS</abbr> are functionally equivalent, use <code>Utilities​.equalsIgnoreMetadata(myFirstCRS, mySecondCRS)</code>.</p>
<h3 id="crsHashCode">Are <abbr title="Coordinate Reference System">CRS</abbr> objects safe for use as keys in HashMap?<a class="headerlink" href="#crsHashCode" title="Permanent link">&para;</a></h3>
<p>Yes, every classes defined in the <code>org.apache.sis.referencing.crs</code>, <code>cs</code> and <code>datum</code> packages
define properly their <code>equals(Object)</code> and <code>hashCode()</code> methods.
The Apache SIS library itself uses <abbr title="Coordinate Reference System">CRS</abbr> objects in <code>HashMap</code>-like containers for caching purpose.</p>
<h2 id="transforms">Coordinate transformations<a class="headerlink" href="#transforms" title="Permanent link">&para;</a></h2>
<h3 id="axisOrderInTransforms">My transformed coordinates are totally wrong!<a class="headerlink" href="#axisOrderInTransforms" title="Permanent link">&para;</a></h3>
<p>This is most frequently caused by ordinate values given in the wrong order.
Developers tend to assume a (<em>x</em>, <em>y</em>) or (<em>longitude</em>, <em>latitude</em>) axis order.
But geographers and pilots are using (<em>latitude</em>, <em>longitude</em>) axis order for centuries,
and the EPSG geodetic dataset defines geographic Coordinate Reference Systems that way.
If a coordinate transformation seems to produce totally wrong values,
the first thing to do should be to print the source and target Coordinate Reference Systems:</p>
<div class="codehilite"><pre><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sourceCRS</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">targetCRS</span><span class="o">);</span>
</pre></div>


<p>Attention should be paid to the order of <code>AXIS</code> elements.
In the example below, the Coordinate Reference System clearly uses (<em>latitude</em>, <em>longitude</em>) axis order:</p>
<div class="codehilite"><pre>GeodeticCRS[&quot;WGS 84&quot;,
  Datum[&quot;World Geodetic System 1984&quot;,
    Ellipsoid[&quot;WGS 84&quot;, 6378137.0, 298.257223563]],
  CS[ellipsoidal, 2],
    Axis[&quot;Geodetic latitude (Lat)&quot;, north],
    Axis[&quot;Geodetic longitude (Lon)&quot;, east],
    Unit[&quot;degree&quot;, 0.017453292519943295]]
</pre></div>


<p>If (<em>longitude</em>, <em>latitude</em>) axis order is really wanted, Apache SIS can be forced to that order <a href="#axisOrder">as described above</a>.</p>
<h3 id="projectionName">I have correct axis order but my transformed coordinates are still wrong.<a class="headerlink" href="#projectionName" title="Permanent link">&para;</a></h3>
<p>Make sure that the right projection is used. Some projection names are confusing.
For example <em>"Oblique Mercator"</em> and <em>"Hotine Oblique Mercator"</em> (in EPSG naming) are two different projections.
But <em>"Oblique Mercator"</em> (not Hotine) in EPSG naming is also called <em>"Hotine Oblique Mercator Azimuth Center"</em> by ESRI,
while <em>"Hotine Oblique Mercator"</em> (EPSG naming) is called <em>"Hotine Oblique Mercator Azimuth Natural Origin"</em> by ESRI.</p>
<p>The <em>"Oblique Stereographic"</em> projection (EPSG name) is called <em>"Double Stereographic"</em> by ESRI.
ESRI also defines a <em>"Stereographic"</em> projection, which is actually an oblique projection like the former but using different formulas.</p>
<h3 id="parameterUnits">I just used the WKT of a well-known authority and my transformed coordinates are still wrong!<a class="headerlink" href="#parameterUnits" title="Permanent link">&para;</a></h3>
<p>The Well Known Text (WKT) specification has been interpreted in different ways by different implementors.
One subtle issue is the angular units of prime meridian and projection parameter values.
The WKT 1 specification clary states: <em>"If the <code>PRIMEM</code> clause occurs inside a <code>GEOGCS</code>,
then the longitude units will match those of the geographic coordinate system"</em> (source: <abbr title="Open Geospatial Consortium">OGC</abbr> 01-009).
However ESRI and GDAL among others unconditionally use decimal degrees, ignoring this part of the WKT specification.
This problem can be identified by WKT inspection as in the following extract:</p>
<div class="codehilite"><pre>PROJCS[&quot;Lambert II étendu&quot;,
  GEOGCS[&quot;Nouvelle Triangulation Française&quot;, …,
    PRIMEM[&quot;Paris&quot;, 2.337229167],
    UNIT[&quot;grad&quot;, 0.01570796326794897]]
  PROJECTION[&quot;Lambert_Conformal_Conic_1SP&quot;],
  PARAMETER[&quot;latitude_of_origin&quot;, 46.8], …]
</pre></div>


<p>The Paris prime meridian is located at approximatively 2.597 gradians from Greenwich, which is 2.337 degrees.
From this fact, we can see that the above WKT uses decimal degrees despite its <code>UNIT["grad"]</code> declaration.
This mismatch applies also to the parameter value, which declare 46.8° in the above example while the official value is 52 gradians.
By default, Apache SIS interprets those angular values as gradians when parsing such WKT, resulting in a large error.
In order to get the intended result, there is a choice:</p>
<ul>
<li>
<p>Replace <code>UNIT["grad", 0.01570796326794897]</code> by <code>UNIT["degree", 0.017453292519943295]</code>,
    which ensure that Apache SIS, GDAL and ESRI understand that WKT in the same way.</p>
</li>
<li>
<p>Or ask explicitely Apache SIS to parse the WKT using the ESRI or GDAL conventions, by specifying the
    <code>Convention.​WKT1_COMMON_UNITS</code> enumeration value to <code>WKTFormat</code> in the <code>org.​apache.​sis.​io.​wkt</code> package.</p>
</li>
</ul>
<p>Note that the GeoPackage standard explicitely requires <abbr title="Open Geospatial Consortium">OGC</abbr> 01-009 compliant WKT
and the new WKT 2 standard also follows the <abbr title="Open Geospatial Consortium">OGC</abbr> 01-009 interpretation.
The default Apache SIS behavior is consistent with those two standards.</p>
<h3 id="BursaWolf">I verified all the above and still have an error of about one kilometer.<a class="headerlink" href="#BursaWolf" title="Permanent link">&para;</a></h3>
<p>Coordinate Reference Systems (<abbr title="Coordinate Reference System">CRS</abbr>) approximate the Earth’s shape by an ellipsoid.
Different ellipsoids (actually different <em>datum</em>) are used in different countries of the world and at different time in history.
When transforming coordinates between two <abbr title="Coordinate Reference System">CRS</abbr> using the same datum, no Bursa-Wolf parameters are needed.
But when the transformation involves a change of datum, the referencing module needs some information about how to perform that datum shift.</p>
<p>There is many way to specify how to perform a datum shift, and most of them are only approximation.
The Bursa-Wolf method is one of them, not the only one. However it is one of the most frequently used methods.
The Bursa-Wolf parameters can be specified inside a <code>TOWGS84</code> element with version 1 of Well Known Text (WKT) format,
or in a <code>BOUNDCRS</code> element with version 2 of WKT format.
If the <abbr title="Coordinate Reference System">CRS</abbr> are parsed from a WKT string, make sure that the string contains the appropriate element.</p>
<h3 id="slightDifferences">I get slightly different results depending on the environment I’m running in.<a class="headerlink" href="#slightDifferences" title="Permanent link">&para;</a></h3>
<p>The results of coordinate transformations when running in a web application container (JBoss, <em>etc.</em>)
may be a few meters off compared to coordinates transformations in an IDE (NetBeans, Eclipse, <em>etc.</em>).
The results depend on whether an EPSG factory is available on the classpath, <strong>regardless how the <abbr title="Coordinate Reference System">CRS</abbr> were created</strong>,
because the EPSG factory specifies explicitly the coordinate operation to apply for some pairs of <abbr title="Coordinate Reference System">CRS</abbr>.
In such case, the coordinate operation specified by EPSG has precedence over the Burwa-Wolf parameters
(the <code>TOWGS84</code> element in version 1 of Well Known Text format).</p>
<p>A connection to the EPSG database may have been established for one environment
(typically the JEE one) and not the other (typically the IDE one) because only the former has <abbr title="Java DataBase Connectivity">JDBC</abbr> driver.
The recommended way to uniformize the results is to add in the second environment (IDE)
the same <abbr title="Java DataBase Connectivity">JDBC</abbr> driver than the one available in the first environment (JEE).
It should be one of the following: JavaDB (a.k.a. Derby), HSQL or PostgreSQL.
Make sure that the <a href="epsg.html">connection parameters to the EPSG database</a> are also the same.</p>
<h3 id="toWGS84">Can I always expect a transform from an arbitrary <abbr title="Coordinate Reference System">CRS</abbr> to WGS84 to succeed?<a class="headerlink" href="#toWGS84" title="Permanent link">&para;</a></h3>
<p>For 2D horizontal <abbr title="Coordinate Reference System">CRS</abbr> created from the EPSG database, calls to <code>CRS.findOperation(…)</code> should generally succeed.
For 3D <abbr title="Coordinate Reference System">CRS</abbr> having any kind of height different than ellipsoidal height, or for a 2D <abbr title="Coordinate Reference System">CRS</abbr> of type <code>EngineeringCRS</code>, it may fail.
Note however that even if the call to <code>CRS.findOperation(…)</code> succeed, the call to <code>MathTransform.transform(…)</code> may fail
or produce <code>NaN</code> or infinity values if the coordinate to transform is far from the domain of validity.</p>
<h1 id="metadata">Metadata<a class="headerlink" href="#metadata" title="Permanent link">&para;</a></h1>
<h2 id="metadata-implementation">Custom implementations<a class="headerlink" href="#metadata-implementation" title="Permanent link">&para;</a></h2>
<h3 id="metadata-proxy">My metadata are stored in a database-like framework. Implementing every GeoAPI interfaces for them is impractical.<a class="headerlink" href="#metadata-proxy" title="Permanent link">&para;</a></h3>
<p>Developers do not need to implement directly the metadata interfaces.
If the underlying storage framework can access metadata from their class and attribute names (either Java names
or <abbr title="International Organization for Standardization">ISO</abbr>/<abbr title="Open Geospatial Consortium">OGC</abbr> names), then it is possible to implement a single engine accessing any kind of metadata and let the
Java Virtual Machine implements the GeoAPI interfaces on-the-fly, using the <code>java.lang.reflect.Proxy</code> class.
See the <code>Proxy</code> Javadoc for details, keeping in mind that the <abbr title="International Organization for Standardization">ISO</abbr>/<abbr title="Open Geospatial Consortium">OGC</abbr> name of a <code>java.lang.Class</code> or
<code>java.lang.reflect.Method</code> object can be obtained as below:</p>
<div class="codehilite"><pre><span class="n">UML</span> <span class="n">uml</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="n">UML</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">uml</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">uml</span><span class="o">.</span><span class="na">identifier</span><span class="o">();</span>
    <span class="c1">// Fetch the metadata here.</span>
<span class="o">}</span>
</pre></div>


<p>This is indeed the approach taken by the <code>org.apache.sis.metadata.sql</code> package for providing an implementation
of all GeoAPI metadata interfaces reading their values directly from a SQL database.</p>
<h3 id="metadata-unknownClass">I can not marshall my custom implementation.<a class="headerlink" href="#metadata-unknownClass" title="Permanent link">&para;</a></h3>
<p>The classes given to the JAXB marshaller shall contain JAXB annotations,
otherwise the following exception is thrown:</p>
<div class="codehilite"><pre>javax.xml.bind.JAXBException: class MyCustomClass nor any of its super class is known to this context.
</pre></div>


<p>The easiest workaround is to wrap the custom implementation into one of the implementations
provided in the <code>org.apache.metadata.iso</code> package.
All those SIS implementation classes provide shallow copy constructor for making that easy.
Note that you need to wrap only the root class, not the attributes.
The attribute values will be wrapped automatically as needed by JAXB adapters.</p>
            </article>
          </section>
        </div><!--/span-->
      </div><!--/row-fluid-->
    </div><!--/container-fluid-->

  <footer class="footer">
    <div class="container">
      <p>Copyright &copy; 2013-2018 The Apache Software Foundation, Licensed under the
        <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br />
          Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
    </div>
  </footer>

  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

</body>
</html>
