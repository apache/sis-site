<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Apache SIS branches</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="http://www.apache.org/css/code.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/sis.css">

    

    
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License.  You may obtain a copy of the License at . http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the specific language governing permissions and limitations under the License. -->
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/index.html"> Apache SIS&trade; </a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="mail-lists.html">Mailing Lists</a></li>
                  <li><a href="http://www.apache.org/licenses/">Project License</a></li>
                  <li><a href="team-list.html">Project Team</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="book/index.html">Developer guide</a></li>
                  <li><a href="apidocs/index.html">Online Javadoc</a></li>
                  <li><a href="downloads.html">Downloads</a></li>
                  <li><a href="source.html">Source Code</a></li>
                  <li><a href="code-patterns.html">Code patterns</a></li>
                  <li><a href="faq.html">FAQ</a></li>
                  <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org">The Foundation</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div> <!-- /.nav-collapse -->
        </div><!-- /.container -->
      </div><!-- /.navbar-inner -->
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <img src="img/logo.png"/>
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="active"><a href="index.html">Home</a></li>
              <li><a href="mail-lists.html">Mailing Lists</a></li>
              <li><a href="http://www.apache.org/licenses/">Project License</a></li>
              <li><a href="team-list.html">Project Team</a></li>
              <li class="nav-header">Project Documentation</li>
              <li><a href="book/index.html">Developer guide</a></li>
              <li><a href="apidocs/index.html">Online Javadoc</a></li>
              <li><a href="downloads.html">Downloads</a></li>
              <li><a href="source.html">Source Code</a></li>
              <li><a href="code-patterns.html">Code patterns</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
              <li class="nav-header">ASF</li>
              <li><a href="http://www.apache.org">The Foundation</a></li>
              <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
              <li><a href="http://www.apache.org/security/">Security</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span10">
          <section id="content" class="row">
            <article class="span12">
              <p class="page-title">Apache SIS branches</p>
              <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>The <a href="source.html">source code repository</a> contains JDK7 and JDK8 branches together with the trunk.
The Apache SIS releases are created from the code on the trunk only.
However the actual development often occur on a branch before to be merged to the trunk.
Those branches exist in order to experiment early the new technologies — since it may impact
the library design — while keeping the releases compatible with more common environments.</p>
<p>This page lists the Apache SIS development branches, provides some coding recommendations
for making merges easier, then provides the steps to follow for performing the merges.</p>
<div class="toc">
<ul>
<li><a href="#development">The development branches</a><ul>
<li><a href="#jdk8">branches/JDK8</a></li>
<li><a href="#jdk7">branches/JDK7</a><ul>
<li><a href="#behavior-jdk7">Behavioral differences</a></li>
</ul>
</li>
<li><a href="#trunk">trunk</a><ul>
<li><a href="#behavior">Behavioral differences</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#recommendations">Coding recommendations</a><ul>
<li><a href="#formatting">Formatting</a></li>
<li><a href="#imports">Import statements</a></li>
<li><a href="#substitutions">Substitution for non-existent classes</a></li>
</ul>
</li>
<li><a href="#merges">Performing the merges</a><ul>
<li><a href="#merge-two-branches">Merging changes between two branches</a></li>
<li><a href="#merge-record-only">Declaring that some changes shall not be merged</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="development">The development branches<a class="headerlink" href="#development" title="Permanent link">&para;</a></h1>
<p>Developers are encouraged to select the first branch listed below, in that order, which meet their needs.</p>
<h2 id="jdk8">branches/JDK8<a class="headerlink" href="#jdk8" title="Permanent link">&para;</a></h2>
<p>The JDK8 branch is the recommended development branch for developers who can use a JDK8 environment.
This branch implements the interfaces defined in the <a href="http://www.geoapi.org/snapshot/index.html">GeoAPI snapshot</a> milestones
and uses some JDK8 or JDK7-specific features like:</p>
<ul>
<li>Syntax enhancements, mostly in exception handling (<em>try-with-resources</em>, <em>multi-catches</em>)
    but also on other aspects like <em>diamond operator</em>.</li>
<li>Leveraging of new API (<em>suppressed exceptions</em>, <em>file systems</em>, <em>fork join</em>).</li>
<li>Functional interfaces and lambda expressions.</li>
</ul>
<h2 id="jdk7">branches/JDK7<a class="headerlink" href="#jdk7" title="Permanent link">&para;</a></h2>
<p>The JDK7 branch is a merge of the JDK8 branch ported to the JDK7 platform.
The JDK7 branch implements the same GeoAPI interfaces than the JDK8 branch;
the only differences (apart version number) are the modifications necessary
for building and running on a JDK7 platform:</p>
<ul>
<li><em>Lambda expressions</em> replaced by anonymous classes.</li>
<li>New methods on collection interfaces replaced by calls to static methods.</li>
<li><code>java.util.function</code> and <code>java.time</code> API replaced by internal placeholder classes.</li>
</ul>
<h3 id="behavior-jdk7">Behavioral differences<a class="headerlink" href="#behavior-jdk7" title="Permanent link">&para;</a></h3>
<p>The JDK7 branch should behaves in a way close to identical to the JDK8 branch,
with possible variations in the following aspects:</p>
<ul>
<li>Usage of <code>java.time.format.DateTimeFormatter</code> for parsing and formatting ISO 8601 dates
    are simulated by usage of <code>java.text.SimpleDateFormat</code>. Those two formatters may not have
    the same tolerance to inputs that deviate from the standard.</li>
</ul>
<h2 id="trunk">trunk<a class="headerlink" href="#trunk" title="Permanent link">&para;</a></h2>
<p>The trunk is a merge of the JDK7 branch ported to the interfaces defined by the <a href="http://www.geoapi.org/3.0/index.html">GeoAPI stable release</a>.
This is the code which is built by the continuous integration system and deployed on the Maven repository.
The main differences (apart version number) compared to the JDK7 branch are the modifications
necessary for implementing an older version of the GeoAPI interfaces:</p>
<ul>
<li>
<p>Usages of non-existent GeoAPI interfaces are replaced by direct usages of the
    corresponding Apache SIS implementation.</p>
</li>
<li>
<p>When a new revision of a standard is available,
    the trunk still uses the old version since the new revision is not available in GeoAPI 3.0.
    Sometime it results in usage of methods that are deprecated on the SIS development branches.</p>
</li>
</ul>
<p>For security reasons and for avoiding misleading information, the following functionalities are disabled on trunk
(but are still enabled on branches as experimental features). In particular the <code>Supervisor.ENABLED</code> flag controls
whether the MBeans documented in the <code>org.apache.sis.console</code> package are enabled or not.</p>
<ul>
<li>In <code>core/sis-utility/src/main/java/org/apache/sis/internal/system/Supervisor.java</code>, the <code>ENABLED</code> flag is set to <code>false</code>.</li>
<li>In <code>core/sis-utility/src/main/java/org/apache/sis/internal/util/TemporalUtilities.java</code>, the <code>REPORT_MISSING_MODULE</code> flag is set to <code>false</code>.</li>
</ul>
<p>Above flag values may change in future SIS releases.</p>
<h3 id="behavior">Behavioral differences<a class="headerlink" href="#behavior" title="Permanent link">&para;</a></h3>
<p>Because of changes between GeoAPI 3.0 and GeoAPI 4.0-SNAPSHOT, the following aspects need special care:</p>
<ul>
<li>If <code>op</code> is an instance of <code>PassThroughOperation</code>, then the <code>if (op instanceof SingleOperation)</code> expression
    evaluates to <code>true</code> on trunk but to <code>false</code> on SIS development branches.</li>
</ul>
<h1 id="recommendations">Coding recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h1>
<p>The following recommendations aim to make the merges easier by reducing the extend of potential conflicts.</p>
<h2 id="formatting">Formatting<a class="headerlink" href="#formatting" title="Permanent link">&para;</a></h2>
<p>Refrain from doing massive code reformatting unless:</p>
<ul>
<li>the modified files do not yet exist on the other branches;</li>
<li>or the modified lines are known to be identical on all active branches (merges work well in such cases);</li>
<li>or the committer is willing to resolve the merge conflicts.</li>
</ul>
<h2 id="imports">Import statements<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h2>
<p>Isolate at the end of the imports section any import statements that are specific to a platform.
This separation allows any branch to re-arrange the common import statements without generating
conflicts with the platform-dependent import statements. Example:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sis.util.ArgumentChecks</span><span class="o">;</span>

<span class="c1">// Branch-specific imports</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>
</pre></div>


<h2 id="substitutions">Substitution for non-existent classes<a class="headerlink" href="#substitutions" title="Permanent link">&para;</a></h2>
<p>When using a JDK8 class that does not exist on JDK7, define a class of the same name in a
<code>org.apache.sis.internal</code> sub-package with the minimal amount of needed functionalities,
provided that it can be done with reasonable effort. Otherwise just delete the JDK8-dependent
code from the JDK7 branch.</p>
<h1 id="merges">Performing the merges<a class="headerlink" href="#merges" title="Permanent link">&para;</a></h1>
<p>Subversion 1.5 and later maintain a <code>svn:mergeinfo</code> property which make merge operations much easier.
In order to get those merge information properly maintained, no merge operation shall be performed
with older Subversion tools.</p>
<h2 id="merge-two-branches">Merging changes between two branches<a class="headerlink" href="#merge-two-branches" title="Permanent link">&para;</a></h2>
<p>The branches and trunk checkout directories can be located anywhere on the developer machine.
The following example assumes that the current directory contains the following sub-directories:</p>
<ul>
<li><code>JDK7</code> as a checkout of <code>http://svn.apache.org/repos/asf/sis/branches/JDK7</code>.</li>
<li><code>JDK8</code> as a checkout of <code>http://svn.apache.org/repos/asf/sis/branches/JDK8</code>.</li>
</ul>
<p>However the instructions below can be adapted to different directory locations by changing
the paths given in argument to the <code>cd</code> and <code>svn merge</code> commands.</p>
<p>Assuming that the developer wants to merge the changes <em>from</em> the JDK8 directory <em>to</em> the JDK7 directory,
then the following commands can be executed.
Do <strong>not</strong> specify any revision number to the <code>svn merge</code> command.
Instead, let Subversion infers the proper revisions range from the <code>svn:mergeinfo</code> property.</p>
<div class="codehilite"><pre><span class="nb">cd </span>JDK8
svn update
<span class="nb">cd</span> ../JDK7
svn update
svn merge ../JDK8
</pre></div>


<p>If Subversion reports any conflicts (flagged by the <code>C</code> letter before the file names),
then edit the conflicted files in any IDE and mark them as resolved:</p>
<div class="codehilite"><pre>svn resolved path/to/the/resolved/file
</pre></div>


<p>Clean the workspace and test the build. We suggest to execute the Maven commands in the following order,
since <code>mvn compile</code> will find compilation problems much faster than <code>mvn install</code>.
If any of those commands fail, edit the files at cause and re-try from the command that failed
(there is usually no need to run <code>mvn clean</code> again).</p>
<div class="codehilite"><pre>mvn clean
mvn compile
mvn <span class="nb">test</span>-compile
mvn install
</pre></div>


<p>After a successful build, commit:</p>
<div class="codehilite"><pre>svn commit --message <span class="s2">&quot;Merge from the JDK8 branch.&quot;</span>
</pre></div>


<h2 id="merge-record-only">Declaring that some changes shall not be merged<a class="headerlink" href="#merge-record-only" title="Permanent link">&para;</a></h2>
<p>If a developers wants to apply some changes specific to the JDK8 platform and tells
Subversion to not propagate those changes to the JDK7 branch, then the following
procedure shall be applied:</p>
<ul>
<li>Before to apply JDK8-specific changes, merge any pending changes to the JDK7 branch.</li>
<li>Apply the JDK8-specific changes and commit.</li>
<li>Run the following commands (edit the path arguments if the directory layout is different
    than the example from the previous section):</li>
</ul>
<p>Commands:</p>
<div class="codehilite"><pre><span class="nb">cd </span>JDK8
svn update
<span class="nb">cd</span> ../JDK7
svn update
svn merge --record-only ../JDK8
svn commit --message <span class="s2">&quot;Skip JDK8-specific changes.&quot;</span>
</pre></div>
            </article>
          </section>
        </div><!--/span-->
      </div><!--/row-fluid-->
    </div><!--/container-fluid-->

  <footer class="footer">
    <div class="container">
      <p>Copyright &copy; 2013-2017 The Apache Software Foundation, Licensed under the
        <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br />
          Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
    </div>
  </footer>

  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

</body>
</html>
