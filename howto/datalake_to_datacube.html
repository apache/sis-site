<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Apache SIS - From data lake to data cube</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="../sis.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../syntax.css">
  </head>
  <body>
    <div class="topbar">
      <a class="topbar-brand" href="../index.html">Apache SIS™</a>
      <ul class="topbar-items">
        <li>
          <a href="https://www.apache.org/events/current-event.html">
             <img class="apache-con" src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="main-section">
      <nav class="left-bar">
        <ul class="nav-pills">
          <li><a class="nav-link  inactive " href="../index.html">Home</a></li>
          <li><a class="nav-link  inactive " href="../about.html">About</a></li>
          <li><a class="nav-link  inactive " href="../downloads.html">Downloads</a></li>
          <li><a class="nav-link  active " href="../howto.html">How to…</a></li>
          <li><a class="nav-link  inactive " href="../standards.html">Standards</a></li>
          <li><a class="nav-link  inactive " href="../formats.html">Data formats</a></li>
          <li><a class="nav-link  inactive " href="../epsg.html">EPSG Database</a></li>
          <li><a class="nav-link  inactive " href="../javafx.html">Application (demo)</a></li>
          <li><a class="nav-link  inactive " href="../documentation.html">Documentation</a></li>
        </ul>
      </nav>
      <div class="main-content">
        <main class="container">
          <article>
            <img src="../images/logo.png" class="sis-logo" align="left"/>
            <p class="page-title">From data lake to data cube</p>

  <p>This example opens a few files where each file represent a slice in a data cube.
Then the slices are aggregated together in a single multi-dimensional data cube.
For example each file may be a raster representing Sea Surface Temperature (SST) at a specific day,
and those files can be a aggregated in a single three-dimensional raster with a temporal dimension.</p>
<p>A current limitation is that each slice must have the same number of dimensions than the data cube.
For the example of SST raster for a specific day, the raster CRS must still have a temporal axis
even if the grid contains only one cell in the temporal dimension.
A future Apache SIS version will provide methods for adding dimensions.</p>
<p>This example assumes that all slice have the same size, resolution and coordinate reference system.
If this is not the case, the aggregation will still work but instead of producing a data cube,
it may produce an <code>Aggregate</code> resource containing a tree like below:</p>
<pre tabindex="0"><code>Root aggregate
├─ All coverages with same sample dimensions #1
│  └─ ...
└─ All coverages with same sample dimensions #2
   ├─ Coverages with equivalent reference systems #1
   │  └─ ...
   └─ Coverages with equivalent reference systems #2
      ├─ Slices with compatible &#34;grid to CRS&#34; #1
      ├─ Slices with compatible &#34;grid to CRS&#34; #2
      └─ ...&lt;/pre&gt;
</code></pre><p>A future Apache SIS version will provide methods for controlling the way to aggregate
such heterogeneous data set.</p>
<p>This example works with <code>Resource</code> instances, which are not necessarily data loaded in memory.
Consequently the <code>DataStore</code> instances must be kept open for all the duration of data cube usage.</p>
<h1 id="direct-dependencies">Direct dependencies</h1>
<table>
  <thead>
      <tr>
          <th>Maven coordinates</th>
          <th>Module info</th>
          <th>Remarks</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>org.apache.sis.code:sis-feature</code></td>
          <td><code>org.apache.sis.feature</code></td>
          <td></td>
      </tr>
      <tr>
          <td><code>org.apache.sis.storage:sis-netcdf</code></td>
          <td><code>org.apache.sis.storage.netcdf</code></td>
          <td></td>
      </tr>
      <tr>
          <td><code>edu.ucar:cdm-core</code></td>
          <td></td>
          <td>For netCDF-4 or HDF5</td>
      </tr>
  </tbody>
</table>
<p>The <code>cdm-core</code> dependency can be omitted for netCDF-3 (a.k.a. &ldquo;classic&rdquo;),</p>
<h1 id="code-example">Code example</h1>
<p>The file name and geospatial coordinates in following code need to be updated for yours data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.File</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.storage.DataStore</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.storage.DataStores</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.storage.DataStoreException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.storage.GridCoverageResource</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.storage.aggregate.CoverageAggregator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DataLakeToDataCube</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Demo entry point.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param  args  ignored.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws DataStoreException if an error occurred while reading the raster.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DataStoreException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">DataStore</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataStores</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">&#34;CMEMS_20220301.nc&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">DataStore</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataStores</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">&#34;CMEMS_20220302.nc&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="n">DataStore</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataStores</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">&#34;CMEMS_20220303.nc&#34;</span><span class="p">)))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">             * Following casts are okay if we know that the resources are raster data,
</span></span></span><span class="line"><span class="cl"><span class="cm">             * all of them having the same grid geometry. Otherwise the code can still
</span></span></span><span class="line"><span class="cl"><span class="cm">             * work but would require more `if (x instanceof Y)` checks.
</span></span></span><span class="line"><span class="cl"><span class="cm">             */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GridCoverageResource</span><span class="p">)</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="na">findResource</span><span class="p">(</span><span class="s">&#34;sea_surface_height_above_geoid&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GridCoverageResource</span><span class="p">)</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="na">findResource</span><span class="p">(</span><span class="s">&#34;sea_surface_height_above_geoid&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GridCoverageResource</span><span class="p">)</span><span class="w"> </span><span class="n">s3</span><span class="p">.</span><span class="na">findResource</span><span class="p">(</span><span class="s">&#34;sea_surface_height_above_geoid&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&#34;Extent of first set of slices:%n%s%n&#34;</span><span class="p">,</span><span class="w">  </span><span class="n">r1</span><span class="p">.</span><span class="na">getGridGeometry</span><span class="p">().</span><span class="na">getExtent</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&#34;Extent of second set of slices:%n%s%n&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">.</span><span class="na">getGridGeometry</span><span class="p">().</span><span class="na">getExtent</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&#34;Extent of third set of slices:%n%s%n&#34;</span><span class="p">,</span><span class="w">  </span><span class="n">r3</span><span class="p">.</span><span class="na">getGridGeometry</span><span class="p">().</span><span class="na">getExtent</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">aggregator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoverageAggregator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">aggregator</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">r1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">aggregator</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">r2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">aggregator</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">r3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">dataCube</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GridCoverageResource</span><span class="p">)</span><span class="w"> </span><span class="n">aggregator</span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">             * From this point, the data cube can be used as a three-dimension grid coverage.
</span></span></span><span class="line"><span class="cl"><span class="cm">             * See &#34;Get raster values at geographic (or pixel) coordinates&#34; for usage examples.
</span></span></span><span class="line"><span class="cl"><span class="cm">             * However all usages must be done inside this `try` block.
</span></span></span><span class="line"><span class="cl"><span class="cm">             */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&#34;Extent of the data cube:%n%s%n&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">dataCube</span><span class="p">.</span><span class="na">getGridGeometry</span><span class="p">().</span><span class="na">getExtent</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h1 id="output">Output</h1>
<p>The output depends on the raster data and the locale.
Below is an example:</p>
<pre tabindex="0"><code>Extent of first set of slices:
Column: [0 …  864]  (865 cells)
Row:    [0 … 1080] (1081 cells)
Time:   [0 …   95]   (96 cells)

Extent of second set of slices:
Column: [0 …  864]  (865 cells)
Row:    [0 … 1080] (1081 cells)
Time:   [0 …   95]   (96 cells)

Extent of third set of slices:
Column: [0 …  864]  (865 cells)
Row:    [0 … 1080] (1081 cells)
Time:   [0 …   95]   (96 cells)

Extent of the data cube:
Column: [0 …  864]  (865 cells)
Row:    [0 … 1080] (1081 cells)
Time:   [0 …  287]  (288 cells)
</code></pre>

          </article>
        </main>
        <footer>
          <div class="container">
            <p>Copyright &copy; 2013-2025 The Apache Software Foundation, Licensed under the
            <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
            Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
          </div>
        </footer>
      </div>
    </div>
  </body>
</html>
