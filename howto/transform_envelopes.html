<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Apache SIS - Transform envelopes (bounding boxes)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="../sis.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../syntax.css">
  </head>
  <body>
    <div class="topbar">
      <a class="topbar-brand" href="../index.html">Apache SIS™</a>
      <ul class="topbar-items">
        <li>
          <a href="https://www.apache.org/events/current-event.html">
             <img class="apache-con" src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="main-section">
      <nav class="left-bar">
        <ul class="nav-pills">
          <li><a class="nav-link  inactive " href="../index.html">Home</a></li>
          <li><a class="nav-link  inactive " href="../about.html">About</a></li>
          <li><a class="nav-link  inactive " href="../downloads.html">Downloads</a></li>
          <li><a class="nav-link  active " href="../howto.html">How to…</a></li>
          <li><a class="nav-link  inactive " href="../standards.html">Standards</a></li>
          <li><a class="nav-link  inactive " href="../formats.html">Data formats</a></li>
          <li><a class="nav-link  inactive " href="../epsg.html">EPSG Database</a></li>
          <li><a class="nav-link  inactive " href="../javafx.html">Application (demo)</a></li>
          <li><a class="nav-link  inactive " href="../documentation.html">Documentation</a></li>
        </ul>
      </nav>
      <div class="main-content">
        <main class="container">
          <article>
            <img src="../images/logo.png" class="sis-logo" align="left"/>
            <p class="page-title">Transform envelopes (bounding boxes)</p>

  <p>The transformation of envelopes (or bounding boxes) is a much more difficult task
than transforming the four corners of a rectangle.
The rectangle straight lines in source <abbr title="Coordinate Reference System">CRS</abbr> may become curves in the target <abbr title="Coordinate Reference System">CRS</abbr>
with minimum and maximum values that are not located in any corner.
The calculation is also more complicated if the envelope contains a pole or crosses the anti-meridian.
Apache <abbr title="Spatial Information System">SIS</abbr> handles those complexities in convenience static methods.
This is demonstrated by comparing the result of using Apache <abbr title="Spatial Information System">SIS</abbr> methods
with the result of transforming the four corners.
The latter naive approach has an error of 40 kilometres in this example.</p>
<p>While the example below uses a two-dimensional envelope,
the same Apache <abbr title="Spatial Information System">SIS</abbr> methods can transform efficiently <em>N</em>-dimensional envelopes.</p>
<h1 id="direct-dependencies">Direct dependencies</h1>
<table>
<thead>
<tr>
<th>Maven coordinates</th>
<th>Module info</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>org.apache.sis.core:sis-referencing</code></td>
<td><code>org.apache.sis.referencing</code></td>
</tr>
</tbody>
</table>
<h1 id="code-example">Code example</h1>
<p>Note that all geographic coordinates below express latitude <em>before</em> longitude.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.opengis.geometry.Envelope</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.opengis.referencing.crs.CoordinateReferenceSystem</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.opengis.referencing.operation.CoordinateOperation</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.opengis.referencing.operation.TransformException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.opengis.util.FactoryException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.referencing.CRS</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.referencing.CommonCRS</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.geometry.Envelopes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.geometry.GeneralEnvelope</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.sis.geometry.DirectPosition2D</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TransformEnvelopes</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Demo entry point.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param  args  ignored.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws FactoryException   if an error occurred while creating a Coordinate Reference System (CRS).
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws TransformException if an error occurred while transforming coordinates to the target CRS.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">FactoryException</span><span class="p">,</span><span class="w"> </span><span class="n">TransformException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CoordinateReferenceSystem</span><span class="w"> </span><span class="n">sourceCRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CommonCRS</span><span class="p">.</span><span class="na">WGS84</span><span class="p">.</span><span class="na">geographic</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CoordinateReferenceSystem</span><span class="w"> </span><span class="n">targetCRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CommonCRS</span><span class="p">.</span><span class="na">WGS84</span><span class="p">.</span><span class="na">universal</span><span class="p">(</span><span class="n">90</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Polar stereographic.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">GeneralEnvelope</span><span class="w"> </span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeneralEnvelope</span><span class="p">(</span><span class="n">sourceCRS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bbox</span><span class="p">.</span><span class="na">setRange</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w">  </span><span class="n">84</span><span class="p">,</span><span class="w"> </span><span class="n">88</span><span class="p">);</span><span class="w">             </span><span class="c1">// Latitudes.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bbox</span><span class="p">.</span><span class="na">setRange</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">20</span><span class="p">,</span><span class="w"> </span><span class="n">50</span><span class="p">);</span><span class="w">             </span><span class="c1">// Longitudes.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Envelope</span><span class="w"> </span><span class="n">transformed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Envelopes</span><span class="p">.</span><span class="na">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="n">targetCRS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Envelope</span><span class="w"> </span><span class="n">corners</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transformCorners</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="n">CRS</span><span class="p">.</span><span class="na">findOperation</span><span class="p">(</span><span class="n">sourceCRS</span><span class="p">,</span><span class="w"> </span><span class="n">targetCRS</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Source:  &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bbox</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Result:  &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transformed</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Corners: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">corners</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Errors on Y axis: &#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">corners</span><span class="p">.</span><span class="na">getMinimum</span><span class="p">(</span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">transformed</span><span class="p">.</span><span class="na">getMinimum</span><span class="p">(</span><span class="n">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; metres.&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Transforms the 4 corners of a two-dimensional envelope. This is not recommended.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * This method is provided only for demonstrating that this approach is not sufficient.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param  bbox       the bounding box to transform.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param  operation  the coordinate operation to use for transforming corners.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the result of transforming the 4 corners of the provided bounding box.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws TransformException if a coordinate cannot be converted.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Envelope</span><span class="w"> </span><span class="nf">transformCorners</span><span class="p">(</span><span class="n">Envelope</span><span class="w"> </span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="n">CoordinateOperation</span><span class="w"> </span><span class="n">operation</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">TransformException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">double</span><span class="o">[]</span><span class="w"> </span><span class="n">corners</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMinimum</span><span class="p">(</span><span class="n">0</span><span class="p">),</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMinimum</span><span class="p">(</span><span class="n">1</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMaximum</span><span class="p">(</span><span class="n">0</span><span class="p">),</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMinimum</span><span class="p">(</span><span class="n">1</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMaximum</span><span class="p">(</span><span class="n">0</span><span class="p">),</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMaximum</span><span class="p">(</span><span class="n">1</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMinimum</span><span class="p">(</span><span class="n">0</span><span class="p">),</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="na">getMaximum</span><span class="p">(</span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">operation</span><span class="p">.</span><span class="na">getMathTransform</span><span class="p">().</span><span class="na">transform</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">corners</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">GeneralEnvelope</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeneralEnvelope</span><span class="p">(</span><span class="n">operation</span><span class="p">.</span><span class="na">getTargetCRS</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">result</span><span class="p">.</span><span class="na">getDimension</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">setRange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">corners</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">corners</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">corners</span><span class="p">.</span><span class="na">length</span><span class="p">;)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DirectPosition2D</span><span class="p">(</span><span class="n">corners</span><span class="o">[</span><span class="n">i</span><span class="o">++]</span><span class="p">,</span><span class="w"> </span><span class="n">corners</span><span class="o">[</span><span class="n">i</span><span class="o">++]</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h1 id="output">Output</h1>
<pre tabindex="0"><code>Source:  BOX(84 -20, 88 50)
Result:  BOX(1771965.695226812 1333272.44494046, 2510743.0524805877 1857256.625440407)
Corners: BOX(1771965.695226812 1373480.89677463, 2510743.0524805877 1857256.625440407)
Errors on Y axis: 40208.451834172476 metres.
</code></pre>

          </article>
        </main>
        <footer>
          <div class="container">
            <p>Copyright &copy; 2013-2025 The Apache Software Foundation, Licensed under the
            <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
            Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
          </div>
        </footer>
      </div>
    </div>
  </body>
</html>
