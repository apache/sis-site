<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Apache SIS - Release management</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="./sis.css">
    <link rel="stylesheet" type="text/css" media="screen" href="./syntax.css">
  </head>
  <body>
    <div class="topbar">
      <a class="topbar-brand" href="./index.html">Apache SIS™</a>
      <ul class="topbar-items">
        <li>
          <a href="https://www.apache.org/events/current-event.html">
             <img class="apache-con" src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="main-section">
      <nav class="left-bar">
        <ul class="nav-pills">
          <li><a class="nav-link  inactive " href="./index.html">Home</a></li>
          <li><a class="nav-link  inactive " href="./about.html">About</a></li>
          <li><a class="nav-link  inactive " href="./downloads.html">Downloads</a></li>
          <li><a class="nav-link  inactive " href="./howto.html">How to…</a></li>
          <li><a class="nav-link  inactive " href="./standards.html">Standards</a></li>
          <li><a class="nav-link  inactive " href="./formats.html">Data formats</a></li>
          <li><a class="nav-link  inactive " href="./epsg.html">EPSG Database</a></li>
          <li><a class="nav-link  inactive " href="./javafx.html">Application (demo)</a></li>
          <li><a class="nav-link  inactive " href="./documentation.html">Documentation</a></li>
        </ul>
      </nav>
      <div class="main-content">
        <main class="container">
          <article>
            <img src="./images/logo.png" class="sis-logo" align="left"/>
            <p class="page-title">Release management</p>

  <p>This page describes how to create and deploy the SIS Maven artifacts, binary bundle, javadoc and list of API changes.
The <a href="https://www.apache.org/legal/release-policy.html">Release FAQ</a> page describes the foundation wide policies.
Instructions on this page describe the steps specific to SIS (we do not use the <code>mvn release</code> command).
The intended audiences are SIS release managers.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites   </a>
      <ul>
        <li><a href="#directory-layout">Directory layout   </a></li>
        <li><a href="#generate-key">Generate GPG key   </a></li>
        <li><a href="#trust">Web of trust   </a></li>
        <li><a href="#gradle-config">Gradle configuration   </a></li>
        <li><a href="#maven-config">Maven configuration   </a></li>
      </ul>
    </li>
    <li><a href="#release-config">Specific release configuration   </a></li>
    <li><a href="#prereview">Review project status before branching   </a>
      <ul>
        <li><a href="#update-crs-list">Update the list of supported CRS   </a></li>
        <li><a href="#release-notes">Prepare release notes   </a></li>
      </ul>
    </li>
    <li><a href="#create-artifacts">Create release artifacts   </a>
      <ul>
        <li><a href="#dist">Initialize the distribution directory   </a></li>
        <li><a href="#javadoc">Generate Javadoc   </a></li>
        <li><a href="#publish-artifacts">Publish Maven artifacts   </a>
          <ul>
            <li><a href="#publish-parent">Stage the parent POM   </a></li>
            <li><a href="#publish-main">Stage the project arfifacts   </a></li>
            <li><a href="#publish-nonfree">Stage the non-free resources   </a></li>
          </ul>
        </li>
        <li><a href="#stage">Stage the source, binary and Javadoc artifacts   </a></li>
      </ul>
    </li>
    <li><a href="#integration-tests">Integration test   </a>
      <ul>
        <li><a href="#test-binary">Test the binary   </a></li>
        <li><a href="#test-maven">Test the Maven artifacts   </a></li>
        <li><a href="#test-downloads">Test the downloads   </a></li>
      </ul>
    </li>
    <li><a href="#prepare-website">Prepare Web site   </a></li>
    <li><a href="#vote">Put the release candidate up for a vote   </a>
      <ul>
        <li><a href="#veto">Recovering from a vetoed release   </a></li>
      </ul>
    </li>
    <li><a href="#finalize">Finalize the release   </a>
      <ul>
        <li><a href="#update-other-web-sites-jira-github-wiki">Update other web sites (JIRA, GitHub, Wiki):</a></li>
        <li><a href="#announce">Announce the release   </a></li>
      </ul>
    </li>
    <li><a href="#next-release">Update main branch for the next development cycle   </a>
      <ul>
        <li><a href="#nexus-clean">Delete old artifacts on Maven snapshot repository   </a></li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="prerequisites">Prerequisites   </h1>
<p>The instructions in this section need to be done only once per new release manager,
or when configuring a new machine for performing the releases.
If those steps have already been done, jump directly to the <a href="./release-management.html#configure">configuration section</a>.</p>
<p>Before to perform a release, make sure that the following conditions hold:</p>
<ul>
<li>Commands will be executed in a Unix shell.</li>
<li>All the following commands are available on the classpath:
<ul>
<li><code>git</code> for fetching the source code.</li>
<li><code>svn</code> (Subversion) for fetching the non-free sources.</li>
<li><code>gpg</code> (GNU GPG) for signing artifacts.</li>
<li><code>gradle</code> for compiling Apache SIS.</li>
<li><code>java</code> and <code>javac</code> from the Java Development Kit (JDK).</li>
<li><code>zip</code> for creating the release bundles.</li>
</ul>
</li>
</ul>
<h2 id="directory-layout">Directory layout   </h2>
<p>The steps described in this page assume the following directory layout,
where <code>$NEW_VERSION</code> and <code>$RELEASE_CANDIDATE</code> are environment variables introduced <a href="./release-management.html#configure">later</a>.
Some directories are Git checkout, other are ordinary directories. Any other layout can be used,
provided that all relative paths in this page are adjusted accordingly.</p>
<pre tabindex="0"><code>&lt;any root directory for SIS&gt;
├─ $NEW_VERSION-RC
├─ main
├─ non-free
│  ├─ sis-embedded-data
│  └─ sis-epsg
├─ release
│  ├─ distribution
│  │  └─ $NEW_VERSION
│  │     └─ RC$RELEASE_CANDIDATE
│  └─ test
│     └─ maven
└─ site
   ├─ asf-site
   ├─ asf-staging
   ├─ javadoc
   └─ main
</code></pre><p>Create the above directory structure as below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir site
</span></span><span class="line"><span class="cl">mkdir release
</span></span><span class="line"><span class="cl">git clone https://gitbox.apache.org/repos/asf/sis.git main
</span></span><span class="line"><span class="cl">git clone https://gitbox.apache.org/repos/asf/sis-site.git site/main
</span></span><span class="line"><span class="cl">svn checkout https://svn.apache.org/repos/asf/sis/data/non-free
</span></span><span class="line"><span class="cl">svn checkout https://svn.apache.org/repos/asf/sis/release-test release/test
</span></span><span class="line"><span class="cl">svn checkout https://dist.apache.org/repos/dist/dev/sis release/distribution
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> site/main
</span></span><span class="line"><span class="cl">git worktree add ../asf-staging asf-staging
</span></span><span class="line"><span class="cl">git worktree add ../asf-site asf-site
</span></span></code></pre></div><h2 id="generate-key">Generate GPG key   </h2>
<p>The releases have to be signed by public key cryptography signatures.
Detailed instructions about why releases have to be signed are provided on the <a href="https://infra.apache.org/release-signing.html">Release Signing</a> page.
The standard used is OpenPGP (<em>Open Pretty Good Privacy</em>), and a popular software implementation of that standard is GPG (<em>GNU Privacy Guard</em>).
The <a href="https://infra.apache.org/openpgp.html">OpenPGP instructions</a> list out detailed steps on managing your keys.
The following steps provide a summary:</p>
<p>Edit the <code>~/.gnupg/gpg.conf</code> configuration file and add the following configuration options,
or edit the existing values if any:</p>
<pre tabindex="0"><code>personal-digest-preferences SHA512
cert-digest-algo SHA512
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed
</code></pre><p>If a private key already exists for emails or other purposes, it may be a good idea to keep that key as the default one.
Add or modify the following line in the <code>gpg.conf</code> file, replacing <code>&lt;previous_key_id&gt;</code> by the existing key identifier
(a value like <code>621CC013</code>):</p>
<pre tabindex="0"><code>default-key &lt;previous_key_id&gt;
</code></pre><p>Generate 4096 bits RSA key pair using the following command-line. GPG will prompts for various informations.
The list below the command suggests some values, keeping in mind that the new key should be used only for
signing Apache software packages, not for daily emails.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --gen-key
</span></span></code></pre></div><ul>
<li>Kind of key: RSA and RSA (default). Do not create DSA key.</li>
<li>Key size: 4096 bits.</li>
<li>Validity time: 0 (key does not expire).</li>
<li>Real name: the developer&rsquo;s name.</li>
<li>Email address: developer&rsquo;s email address at <code>@apache.org</code>.</li>
<li>Comment: &ldquo;CODE SIGNING KEY&rdquo;.</li>
<li>Passphrase: please choose a strong one.</li>
</ul>
<p>Verify the key information (replace <em>Real Name</em> by the above-cited developer&rsquo;s name, keeping quotes in the command below).
Note the key identifier, which is a value like <code>74383E9D</code>. This key identifier will be needed for the next steps.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --list-sigs <span class="s2">&#34;Real Name&#34;</span>
</span></span></code></pre></div><p>Sends the public key to a keys server (replace <code>&lt;key_id&gt;</code> by the above-cited key identifier).
The default GPG configuration sends the key to <code>hkp://keys.gnupg.net</code>.
Note that while there is many key servers, most of them synchronize changes with each other,
so a key uploaded to one should be disseminated to the rest.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --send-key &lt;key_id&gt;
</span></span></code></pre></div><p>The key publication can be verified by going on the <a href="http://pgp.mit.edu">MIT server</a>,
then entering the developer&rsquo;s &ldquo;Real Name&rdquo; in the <em>Search String</em> field.
It may take a few hours before the published key is propagated.</p>
<p>Generate a revocation certificate. This is not for immediate use, but generating the certificate now
is a safety in case the passphrase is lost. Keep the revocation certificate in a safe place,
preferably on a removable device.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --output revocation_certificate.asc --gen-revoke &lt;key_id&gt;
</span></span></code></pre></div><h2 id="trust">Web of trust   </h2>
<p>Have the key signed by at least three Apache commiters. This can be done by executing the following commands on
the machine of the other Apache commiter, where <code>&lt;key_to_use&gt;</code> is the identifier of the other commiter&rsquo;s key.
Those operation should preferably be done in some event where the commiters can meet face-to-face.
The other commiter should verify that the <code>gpg --fingerprint</code> command output matches the fingerprint of the key to sign.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --recv-keys &lt;key_id&gt;
</span></span><span class="line"><span class="cl">gpg --fingerprint &lt;key_id&gt;
</span></span><span class="line"><span class="cl">gpg --default-key &lt;key_to_use&gt; --sign-key &lt;key_id&gt;
</span></span><span class="line"><span class="cl">gpg --send-key &lt;key_id&gt;
</span></span></code></pre></div><p>The above-cited <em>Release Signing</em> page provides more instructions.
Then, the signed public key shall be appended to the <code>KEYS</code> file on the <a href="https://github.com/apache/sis">SIS source code repository</a>,
then copied to the <a href="https://dist.apache.org/repos/dist/release/sis/">SIS distribution directory</a>.</p>
<h2 id="gradle-config">Gradle configuration   </h2>
<p>Edit the <code>~/.gradle/gradle.properties</code> file, making sure that the following properties are present:</p>
<pre tabindex="0"><code>org.gradle.java.home=&lt;path to a Java installation&gt;
signing.gnupg.keyName=&lt;your key ID&gt;
</code></pre><h2 id="maven-config">Maven configuration   </h2>
<p>Edit the <code>~/.m2/setting.xml</code> file, making sure that the following fragments are present.
Note that the <a href="https://maven.apache.org/guides/mini/guide-encryption.html">password can be enctypted</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;settings&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;servers&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;server&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;id&gt;</span>apache.releases.https<span class="nt">&lt;/id&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;username&gt;</span>login for uploding to Maven Central<span class="nt">&lt;/username&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;password&gt;</span>password for uploading to Maven Central<span class="nt">&lt;/password&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/server&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/servers&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/settings&gt;</span>
</span></span></code></pre></div><h1 id="release-config">Specific release configuration   </h1>
<p>For all instructions in this page, <code>$OLD_VERSION</code> and <code>$NEW_VERSION</code> stand for the version
number of the previous and the new release respectively, and <code>$RELEASE_CANDIDATE</code> stands for
the current release attempt. Those versions shall be set on the command line like below (Unix):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --list-keys                     <span class="c1"># For getting the value to put in &lt;your key ID&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">OLD_VERSION</span><span class="o">=</span>1.3
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NEW_VERSION</span><span class="o">=</span>1.4
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">RELEASE_CANDIDATE</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SIGNING_KEY</span><span class="o">=</span>&lt;your key ID&gt;    <span class="c1"># hexadecimal number with 8 or 40 digits.</span>
</span></span></code></pre></div><p>Make sure that the code signing key is the defauly key declared in <code>~/.gnupg/gpg.conf</code>
during the Maven deployment phase.</p>
<h1 id="prereview">Review project status before branching   </h1>
<p>Replace the <code>$OLD_VERSION</code> number by <code>$NEW_VERSION</code> in the values of following properties on the development branch:</p>
<ul>
<li><code>DOWNLOAD_URL</code> in <code>endorsed/src/org.apache.sis.util/main/org/apache/sis/setup/OptionalInstallations.java</code> file
(note that the version number appears twice, and once more in <code>@since</code> Javadoc tag).</li>
<li>Review the <code>README.md</code> and <code>NOTICE</code> files in root directory.</li>
<li>Review the <code>README</code> file in <code>optional/src/org.apache.sis.gui/bundle/</code>.</li>
</ul>
<p>Commit and merge with other branches up to main branch.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git add --update
</span></span><span class="line"><span class="cl">git commit --message<span class="o">=</span><span class="s2">&#34;Set version number and the EPSG geodetic dataset URL to expected values after release.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># merge with main</span>
</span></span></code></pre></div><p>Before to start the release process, we need to test more extensively the main branch.
The tests described below often reveal errors that were unnoticed in daily builds.
It is better to detect and fix them before to create the release branch.
First, ensure that a PostgreSQL server is running and listening to the default port on local host
(optional but recommended for more exhaustive testing —
see <a href="./source.html#postgres">PostgreSQL testing configuration</a> for more details).
Then execute the following commands and fix as much warnings as practical:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl start postgresql.service        <span class="c1"># Optional — exact command depends on Linux distribution.</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SIS_TEST_OPTIONS</span><span class="o">=</span>extensive,postgresql
</span></span><span class="line"><span class="cl">gradle <span class="nb">test</span>
</span></span></code></pre></div><p>If the <code>SIS_DATA</code> environment variable was set during above build, unset it a try again.
Ideally the build should be tested in both conditions (<code>SIS_DATA</code> set and unset).
That test may be done in a separated shell (console window) in order to preserve
the variable value in the shell performing the release.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">unset</span> SIS_DATA
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$SIS_DATA</span>
</span></span><span class="line"><span class="cl">gradle cleanTest <span class="nb">test</span>
</span></span></code></pre></div><h2 id="update-crs-list">Update the list of supported CRS   </h2>
<p>The following steps regenerate
the <a href="./tables/CoordinateOperationMethods.html">CoordinateOperationMethods</a>
and <a href="./tables/CoordinateReferenceSystems.html">CoordinateReferenceSystems</a> pages.
Those steps are also useful as additional tests, since failure to generate those pages may reveal problems.</p>
<ul>
<li>
<p>Open the <code>AuthorityCodes</code> class and apply the following changes <strong>without committing them.</strong>
They are temporary hacks for including deprecated codes in the CRS list to be generated
(those codes will appear with strike for making clear that they are deprecated):</p>
<ul>
<li>Search <code>DEPRECATED=0</code> (it appears in a SQL fragment) and replace by <code>(DEPRECATED=0 OR TRUE)</code>.</li>
<li>Comment-out the <code>if (table.showColumn != null)</code> block which appears just above the <code>DEPRECATED=0</code> occurrence.
<br><br></li>
</ul>
</li>
<li>
<p>Run the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gradle assemble
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">java --module-path endorsed/build/libs <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --limit-modules org.apache.sis.referencing <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --patch-module org.apache.sis.referencing<span class="o">=</span>endorsed/build/classes/java/test/org.apache.sis.referencing <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --module org.apache.sis.referencing/org.apache.sis.referencing.report.CoordinateOperationMethods
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Following requires a build of NetBeans project for fetching test dependencies. This may change in a future version.</span>
</span></span><span class="line"><span class="cl">java --module-path endorsed/build/libs:netbeans-project/build/dependencies <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --add-modules   org.opengis.geoapi.conformance,org.apache.derby.tools,org.apache.derby.engine <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --limit-modules org.opengis.geoapi.conformance,org.apache.derby.tools,org.apache.derby.engine,org.apache.sis.referencing <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --add-reads     org.apache.sis.referencing<span class="o">=</span>org.opengis.geoapi.conformance,junit <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --patch-module  org.apache.sis.referencing<span class="o">=</span>endorsed/build/classes/java/test/org.apache.sis.referencing <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     --module org.apache.sis.referencing/org.apache.sis.referencing.report.CoordinateReferenceSystems
</span></span></code></pre></div></li>
<li>
<p>If successful, HTML files will be generated in the current directory.
Open those files in a web browser and verify that information are okay,
in particular the SIS and EPSG version numbers in the first paragraph.</p>
</li>
<li>
<p>If okay, move those two HTML files to the <code>../site/main/static/tables/</code> directory, overwriting previous files.
Revert the hack in <code>AuthorityCodes</code> class, then commit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git commit --message<span class="o">=</span><span class="s2">&#34;Update the list CRS and operation methods supported by Apache SIS </span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="release-notes">Prepare release notes   </h2>
<p>We update JIRA soon because doing so is sometimes a reminder of uncompleted tasks in source code.
Update <a href="https://issues.apache.org/jira/browse/SIS">JIRA</a> tasks and prepare release notes as below:</p>
<ul>
<li>Ensure that the <em>Fix Version</em> in issues resolved since the last release includes this release version correctly.</li>
<li>Ensure that all open issues are resolved or closed before proceeding further.</li>
<li>On the <code>site</code> source code repository, create a <code>content/release-notes/$NEW_VERSION.md</code> file with all the features added.</li>
<li>Use <code>content/release-notes/$OLD_VERSION.md</code> as a template, omitting the old list of issues.</li>
<li>The release notes can be obtained from JIRA, by clicking on the <em>Versions</em> tab → the version number → <em>Release notes</em>
and then configuring the release notes to display HTML format and copying it.
A suggested approach would be to reorganize the release notes as
<em>New Features</em>, then <em>Improvements</em>, then <em>Bug Fixes</em>, then <em>Tests</em> and finally <em>Tasks</em>.
The <em>Sub Tasks</em> can be classified according the category of their parent issue.</li>
</ul>
<p>Commit to staging area (not published immediately):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ../site/main
</span></span><span class="line"><span class="cl">cp content/release-notes/<span class="nv">$OLD_VERSION</span>.md content/release-notes/<span class="nv">$NEW_VERSION</span>.md
</span></span><span class="line"><span class="cl"><span class="c1"># Edit release notes before to continue.</span>
</span></span><span class="line"><span class="cl">git add content/release-notes/<span class="nv">$NEW_VERSION</span>.md
</span></span><span class="line"><span class="cl">git commit --message <span class="s2">&#34;Release notes for Apache SIS </span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span></code></pre></div><h1 id="create-artifacts">Create release artifacts   </h1>
<p>Execute the following commands.
It is okay to checkout the branch in a separated directory if desired.
The <code>SIS_RC_DIR</code> environment variable will specify that directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ../main
</span></span><span class="line"><span class="cl">git checkout -b <span class="nv">$NEW_VERSION</span>-RC
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SIS_RC_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</span></span></code></pre></div><p>Remove the files and modules that are not intended to be released.
For example, Apache source distribution shall not include Gradle wrapper binary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git rm .asf.yaml
</span></span><span class="line"><span class="cl">git rm -r gradlew gradlew.bat gradle/
</span></span><span class="line"><span class="cl">git rm -r incubator
</span></span></code></pre></div><p>Edit at least the files listed below for removing all occurrences of &ldquo;incubator&rdquo;
(the search is easier to do after the removal of &ldquo;incubator&rdquo; directory):</p>
<ul>
<li><code>endorsed/src/org.apache.sis.util/main/module-info.java</code></li>
<li><code>netbeans-project/nbproject/project.properties</code></li>
<li><code>netbeans-project/nbproject/project.xml</code></li>
<li><code>settings.gradle.kts</code></li>
<li><code>README.md</code></li>
</ul>
<p>Commit the removals:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Edit above-listed files before to continue.</span>
</span></span><span class="line"><span class="cl">git add --update    <span class="c1"># for the removal of &lt;module&gt; elements in pom.xml files.</span>
</span></span><span class="line"><span class="cl">git commit --message<span class="o">=</span><span class="s2">&#34;Remove the modules to be excluded from </span><span class="nv">$NEW_VERSION</span><span class="s2"> release.&#34;</span>
</span></span></code></pre></div><p>Update SIS version numbers by removing all occurrences of the <code>-SNAPSHOT</code> suffix
at least in the following files:</p>
<ul>
<li><code>parent/pom.xml</code></li>
<li><code>gradle.properties</code></li>
<li><code>endorsed/src/org.apache.sis.openoffice/bundle/README.md</code></li>
<li><code>endorsed/src/org.apache.sis.util/main/org/apache/sis/util/Version.java</code></li>
<li><code>endorsed/src/org.apache.sis.referencing/test/org/apache/sis/referencing/factory/sql/epsg/README.md</code></li>
</ul>
<p>Then commit:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git add --update
</span></span><span class="line"><span class="cl">gradle <span class="nb">test</span>
</span></span><span class="line"><span class="cl">git commit --message<span class="o">=</span><span class="s2">&#34;Set version number to </span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span></code></pre></div><h2 id="dist">Initialize the distribution directory   </h2>
<p>Create the directory for the new version and release candidate within the distribution directory.
The <code>$RELEASE_CANDIDATE</code> variable shall be the number of current release attempt.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ../release/distribution
</span></span><span class="line"><span class="cl">svn update
</span></span><span class="line"><span class="cl">mkdir -p <span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>
</span></span><span class="line"><span class="cl">svn add <span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">DIST_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</span></span></code></pre></div><p>Copy the <code>HEADER.html</code> file from the previous release.
Update the file content if necessary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">svn copy https://dist.apache.org/repos/dist/release/sis/<span class="nv">$OLD_VERSION</span>/HEADER.html .
</span></span></code></pre></div><h2 id="javadoc">Generate Javadoc   </h2>
<p>Execute <code>gradle javadoc</code>. That command will fail. This is a known problem with the current Gradle build configuration.
But it should have created a <code>javadoc.options</code> file that we will patch as below (<code>gedit</code> can be replaced by another editor):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$SIS_RC_DIR</span>
</span></span><span class="line"><span class="cl">gradle javadoc      <span class="c1"># Fail. See workaround below.</span>
</span></span><span class="line"><span class="cl">gedit endorsed/build/tmp/javadoc/javadoc.options
</span></span></code></pre></div><p>Apply the following changes:</p>
<ul>
<li>Move all <code>-classpath</code> content to <code>--module-path</code>.</li>
<li>Add the value of <code>$PATH_TO_FX</code> environment variable to the module-path.</li>
<li>Delete all Java source files listed after the options, everything until the end of file.</li>
<li>Add the following line in-place of deleted lines (omit the <code>org.opengis.geoapi</code> module if not desired):</li>
</ul>
<pre tabindex="0"><code>--module org.opengis.geoapi,org.apache.sis.util,org.apache.sis.metadata,org.apache.sis.referencing,org.apache.sis.referencing.gazetteer,org.apache.sis.feature,org.apache.sis.storage,org.apache.sis.storage.sql,org.apache.sis.storage.xml,org.apache.sis.storage.netcdf,org.apache.sis.storage.geotiff,org.apache.sis.storage.earthobservation,org.apache.sis.cloud.aws,org.apache.sis.portrayal,org.apache.sis.profile.france,org.apache.sis.profile.japan,org.apache.sis.openoffice,org.apache.sis.console,org.apache.sis.gui
</code></pre><p>The following commands temporarily create links to optional modules for inclusion in the Javadoc.
The GeoAPI interfaces may also be copied if they should be bundled with the Javadoc.
Then the Javadoc command is launched manually.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> endorsed/src
</span></span><span class="line"><span class="cl">ln -s ../../optional/src/org.apache.sis.gui
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Replace &#34;../../GeoAPI/3.0.2&#34; by the path to a GeoAPI 3.0.2 checkout, or omit those lines.</span>
</span></span><span class="line"><span class="cl">mkdir endorsed/src/org.opengis.geoapi
</span></span><span class="line"><span class="cl">cp -r ../../GeoAPI/3.0.2/geoapi/src/main/java                    endorsed/src/org.opengis.geoapi/main
</span></span><span class="line"><span class="cl">cp -r ../../GeoAPI/3.0.2/geoapi/src/pending/java/org             endorsed/src/org.opengis.geoapi/main/
</span></span><span class="line"><span class="cl">cp    ../../GeoAPI/3.0.2/geoapi/src/main/java9/module-info.java  endorsed/src/org.opengis.geoapi/main/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">javadoc @endorsed/build/tmp/javadoc/javadoc.options
</span></span><span class="line"><span class="cl">firefox endorsed/build/docs/javadoc/index.html                      <span class="c1"># For verifying the result.</span>
</span></span><span class="line"><span class="cl">rm    endorsed/src/org.apache.sis.gui
</span></span><span class="line"><span class="cl">rm -r endorsed/src/org.opengis.geoapi
</span></span></code></pre></div><p>Prepares the Javadoc ZIP file to be released.
Then update the online Javadoc:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> endorsed/build/docs/
</span></span><span class="line"><span class="cl">mv javadoc apidocs
</span></span><span class="line"><span class="cl">zip -9 -r <span class="nv">$DIST_DIR</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip apidocs
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> -
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ../site/javadoc/
</span></span><span class="line"><span class="cl">rm -r *
</span></span><span class="line"><span class="cl">mv <span class="nv">$SIS_RC_DIR</span>/endorsed/build/docs/apidocs/* .
</span></span><span class="line"><span class="cl">git checkout -- README.md
</span></span><span class="line"><span class="cl">git add --all
</span></span><span class="line"><span class="cl">git commit --message <span class="s2">&#34;Update javadoc for SIS </span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span></code></pre></div><h2 id="publish-artifacts">Publish Maven artifacts   </h2>
<p>This section publishes artifacts to the staging repository.
If there is any issue with the deployment, the staging repository can easily be dropped and recreated.</p>
<h3 id="publish-parent">Stage the parent POM   </h3>
<p>Execute the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$SIS_RC_DIR</span>/parent
</span></span><span class="line"><span class="cl">mvn clean install deploy --activate-profiles apache-release
</span></span></code></pre></div><p>Connect to the <a href="https://repository.apache.org/index.html">Nexus repository</a>.
The artifacts can be found under <em>Build Promotion</em> → <em>Staging repositories</em>,
and searching for <code>org.apache.sis</code> in the <em>Repository</em> column.
Delete all <code>org/apache/sis/parent/$NEW_VERSION/parent-$NEW_VERSION-source-release.zip.*</code> files on the Nexus repository.
They should not be there - source release will be deployed on another repository later.
Then close this staging repository by clicking the checkbox for the open staging repositories
(<code>org.apache.sis-&lt;id&gt;</code>) and press <em>Close</em> in the menu bar.
In the description field, specify <em>&ldquo;Apache SIS parent POM&rdquo;</em>.
Keep the window open, we will need it again later.</p>
<h3 id="publish-main">Stage the project arfifacts   </h3>
<p>Build the project and publish in the Maven local repository.
The <code>org.apache.sis.releaseVersion</code> property will cause Javadoc to be generated for earch artifact
(this step is normally skipped because a bit long) and sign the artifacts.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$SIS_RC_DIR</span>
</span></span><span class="line"><span class="cl">git status      <span class="c1"># Make sure that everything is clean.</span>
</span></span><span class="line"><span class="cl">gradle clean <span class="nb">test</span>
</span></span><span class="line"><span class="cl">gradle assemble
</span></span><span class="line"><span class="cl">mv --interactive optional/build/bundle/apache-sis-<span class="nv">$NEW_VERSION</span>.zip <span class="nv">$DIST_DIR</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rm endorsed/build/docs/*        <span class="c1"># For forcing a rerun.</span>
</span></span><span class="line"><span class="cl">rm optional/build/docs/*
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> optional/build/libs/
</span></span><span class="line"><span class="cl">ln ../../../endorsed/build/libs/*.jar .
</span></span><span class="line"><span class="cl">ln <span class="nv">$PATH_TO_FX</span>/*.jar .
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> -
</span></span><span class="line"><span class="cl">gradle assemble --system-prop org.apache.sis.releaseVersion<span class="o">=</span><span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl">find -name <span class="s2">&#34;org.apache.sis.*-javadoc.jar&#34;</span> -exec zip -d <span class="s1">&#39;{}&#39;</span> errors.log <span class="se">\;</span>
</span></span><span class="line"><span class="cl">gradle publishToMavenLocal --system-prop org.apache.sis.releaseVersion<span class="o">=</span><span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check that the Javadoc archives do not have a size close to zero.</span>
</span></span><span class="line"><span class="cl">ll ~/.m2/repository/org/apache/sis/core/sis-referencing/<span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl">ll ~/.m2/repository/org/apache/sis/application/sis-javafx/<span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl">find ~/.m2/repository/org/apache/sis -name <span class="s2">&#34;sis-*-</span><span class="nv">$NEW_VERSION</span><span class="s2">-*.asc&#34;</span> -exec gpg --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gradle publish --system-prop org.apache.sis.releaseVersion<span class="o">=</span><span class="nv">$NEW_VERSION</span>
</span></span></code></pre></div><p>In the <a href="https://repository.apache.org/index.html">Nexus repository</a>, click on &ldquo;Refresh&rdquo;.
A new <code>org.apache.sis</code> item should appear in the <em>Repository</em> column of <em>Build Promotion</em> → <em>Staging repositories</em>.
Navigate through the artifact tree and make sure that all Javadoc, source and jar files have <code>.asc</code> (GPG signature) and <code>.sha1</code> files.
Select any <code>*-javadoc.jar</code> file and click on the <cite>Archive Browser</cite> tab on the right side.
Select any <code>*.html</code> file which is known to use some of the custom taglets defined in <code>buildSrc</code>.
Click on that file and verify that the custom elements are rendered properly.
Then close this staging repository.
In the description field, specify <em>&ldquo;Apache SIS main artifacts&rdquo;</em>.</p>
<h3 id="publish-nonfree">Stage the non-free resources   </h3>
<p>Go to the directory that contains a checkout of <code>https://svn.apache.org/repos/asf/sis/data/non-free/sis-epsg</code>.
Those modules will not be part of the distribution (except on Maven), but we nevertheless need to ensure that they work.
Replace occurrences of <code>&lt;version&gt;$OLD_VERSION&lt;/version&gt;</code> by <code>&lt;version&gt;$NEW_VERSION&lt;/version&gt;</code> in the <code>pom.xml</code> files.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ../non-free
</span></span><span class="line"><span class="cl">svn update
</span></span><span class="line"><span class="cl">mvn clean install
</span></span><span class="line"><span class="cl">mvn javadoc:javadoc                   <span class="c1"># Test that Javadoc can be generated.</span>
</span></span><span class="line"><span class="cl">svn commit --message <span class="s2">&#34;Set version number and dependencies to </span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">mvn deploy --activate-profiles apache-release
</span></span></code></pre></div><p>Verify the staged artifacts in the <a href="https://repository.apache.org/index.html">Nexus repository</a>.
In the <code>sis-epsg-$NEW_VERSION.jar</code> file, verify that <code>META-INF/LICENSE</code> contains the EPSG terms of use.
Delete all <code>org/apache/sis/non-free/$NEW_VERSION/non-free-$NEW_VERSION-source-release.zip.*</code> files.
Delete all <code>org/apache/sis/non-free/sis-epsg/$NEW_VERSION/sis-epsg-$NEW_VERSION-source.jar.*</code> files.
Then close this staging repository.
In the description field, specify <em>&ldquo;Apache SIS non-free resources&rdquo;</em>.</p>
<p>Click on the <code>org.apache.sis-&lt;id&gt;</code> link in order to get the URL to the temporary Maven repository created by Nexus.
We will announce later (in the <em>Put the release candidate up for a vote</em> section) on the <code>dev@</code> mailing list
the availability of this temporary repository for testing purpose.</p>
<h2 id="stage">Stage the source, binary and Javadoc artifacts   </h2>
<p>The official Apache releases are the files in the <code>$DIST_DIR</code> directory.
By contrast, above Maven artifacts are only conveniences.
We have already staged the Javadoc and binaries.
Now stage the sources and cleanup:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git archive --prefix apache-sis-<span class="nv">$NEW_VERSION</span>-src/ --output <span class="nv">$DIST_DIR</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip <span class="nv">$NEW_VERSION</span>-RC
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$DIST_DIR</span>
</span></span><span class="line"><span class="cl">zip -d apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip apache-sis-<span class="nv">$NEW_VERSION</span>/lib/org.apache.sis.openoffice.jar
</span></span></code></pre></div><p>Sign the source, Javadoc and binary artifacts:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --armor --detach-sign --default-key <span class="nv">$SIGNING_KEY</span> apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip
</span></span><span class="line"><span class="cl">sha512sum apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.sha512
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gpg --armor --detach-sign --default-key <span class="nv">$SIGNING_KEY</span> apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip
</span></span><span class="line"><span class="cl">sha512sum apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip.sha512
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gpg --armor --detach-sign --default-key <span class="nv">$SIGNING_KEY</span> apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
</span></span><span class="line"><span class="cl">sha512sum apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.sha512
</span></span></code></pre></div><p>Verify checksums and signatures:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">find . -name <span class="s2">&#34;*.sha512&#34;</span> -exec sha512sum --check <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</span></span><span class="line"><span class="cl">find . -name <span class="s2">&#34;*.asc&#34;</span>    -exec gpg      --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</span></span></code></pre></div><h1 id="integration-tests">Integration test   </h1>
<p>Create a temporary directory where Apache <abbr title="Spatial Information System">SIS</abbr> will write the EPSG dataset.
Force the Java version to the one supported by Apache SIS (adjust <code>JDK11_HOME</code> as needed).
Specify the URL to the nexus repository, where <code>####</code> is the identifier of the &ldquo;non-free&rdquo; repository.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SIS_DATA</span><span class="o">=</span>/tmp/apache-sis-data
</span></span><span class="line"><span class="cl">mkdir <span class="nv">$SIS_DATA</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span><span class="nv">$JDK11_HOME</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">JDK_JAVA_OPTIONS</span><span class="o">=</span><span class="s2">&#34;-enableassertions -Dorg.apache.sis.epsg.downloadURL&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">JDK_JAVA_OPTIONS</span><span class="o">=</span><span class="nv">$JDK_JAVA_OPTIONS</span><span class="o">=</span>https://repository.apache.org/content/repositories/orgapachesis-####
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">JDK_JAVA_OPTIONS</span><span class="o">=</span><span class="nv">$JDK_JAVA_OPTIONS</span>/org/apache/sis/non-free/sis-epsg/<span class="nv">$NEW_VERSION</span>/sis-epsg-<span class="nv">$NEW_VERSION</span>.jar
</span></span></code></pre></div><h2 id="test-binary">Test the binary   </h2>
<p>Unzip the binaries and execute the examples documented in the <a href="./command-line.html">command-line interface page</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /tmp
</span></span><span class="line"><span class="cl">unzip <span class="nv">$DIST_DIR</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> apache-sis-<span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl">wget https://sis.apache.org/examples/coordinates/AmericanCities.csv
</span></span><span class="line"><span class="cl">wget https://sis.apache.org/examples/coordinates/CanadianCities.csv
</span></span><span class="line"><span class="cl">./bin/sis crs EPSG:6676
</span></span><span class="line"><span class="cl">./bin/sis identifier https://sis.apache.org/examples/crs/MissingIdentifier.wkt
</span></span><span class="line"><span class="cl">./bin/sis identifier https://sis.apache.org/examples/crs/WrongAxisOrder.wkt
</span></span><span class="line"><span class="cl">./bin/sis identifier https://sis.apache.org/examples/crs/EquivalentDefinition.wkt
</span></span><span class="line"><span class="cl">./bin/sis transform --sourceCRS EPSG:4267 --targetCRS EPSG:4326 AmericanCities.csv
</span></span><span class="line"><span class="cl">./bin/sis transform --sourceCRS EPSG:4267 --targetCRS EPSG:4326 CanadianCities.csv
</span></span><span class="line"><span class="cl">./bin/sisfx
</span></span></code></pre></div><h2 id="test-maven">Test the Maven artifacts   </h2>
<p>Go to the test Maven project.
Open the root <code>pom.xml</code> file and set the <code>&lt;version&gt;</code> number to the SIS release to be tested.
Then go to the <code>&lt;url&gt;</code> declaration of <repository>` each block and replace value by the URL
of the temporary Maven repository created by Nexus.
Usually, only the 3 last digits need to be updated.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$SIS_RC_DIR</span>/../release/test/maven
</span></span><span class="line"><span class="cl"><span class="c1"># Edit &lt;url&gt; in pom.xml before to continue.</span>
</span></span><span class="line"><span class="cl">mvn compile
</span></span><span class="line"><span class="cl">svn commit -m <span class="s2">&#34;Test project for SIS </span><span class="nv">$NEW_VERSION</span><span class="s2">-RC</span><span class="nv">$RELEASE_CANDIDATE</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>Clear the local Maven repository in order to force downloads from the Nexus repository, then test.
This will also verify the checksums.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rm -r <span class="nv">$SIS_DATA</span>/*
</span></span><span class="line"><span class="cl">rm -r ~/.m2/repository/org/apache/sis
</span></span><span class="line"><span class="cl">mvn package --show-version --strict-checksums
</span></span></code></pre></div><p>Verify that the EPSG dataset has been created, then cleanup:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">du --summarize --human-readable <span class="nv">$SIS_DATA</span>/Databases/SpatialMetadata
</span></span><span class="line"><span class="cl">mvn clean
</span></span></code></pre></div><h2 id="test-downloads">Test the downloads   </h2>
<p>Stage the release candidate:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$DIST_DIR</span>
</span></span><span class="line"><span class="cl">svn add apache-sis-<span class="nv">$NEW_VERSION</span>-*
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ../..
</span></span><span class="line"><span class="cl">svn commit --message <span class="s2">&#34;SIS </span><span class="nv">$NEW_VERSION</span><span class="s2"> release candidate </span><span class="nv">$RELEASE_CANDIDATE</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>Execute the following commands in any temporary directory for testing the sources:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.asc
</span></span><span class="line"><span class="cl"><span class="c1"># Test</span>
</span></span><span class="line"><span class="cl">gpg --verify apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.asc
</span></span><span class="line"><span class="cl">unzip apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> apache-sis-<span class="nv">$NEW_VERSION</span>-src
</span></span><span class="line"><span class="cl">gradle assemble
</span></span></code></pre></div><p>Execute the following commands in any temporary directory for testing the binary:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.asc
</span></span><span class="line"><span class="cl"><span class="c1"># Test</span>
</span></span><span class="line"><span class="cl">gpg --verify apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.asc
</span></span><span class="line"><span class="cl">unzip apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> apache-sis-<span class="nv">$NEW_VERSION</span>
</span></span><span class="line"><span class="cl"><span class="nb">unset</span> SIS_DATA
</span></span><span class="line"><span class="cl">./bin/sis about --verbose
</span></span><span class="line"><span class="cl">./bin/sis crs https://raw.githubusercontent.com/apache/sis/main/endorsed/src/org.apache.sis.referencing/test/org/apache/sis/referencing/crs/ProjectedCRS.xml --format WKT
</span></span></code></pre></div><h1 id="prepare-website">Prepare Web site   </h1>
<p>Review and update the <code>static/DOAP.rdf</code> file on the <code>site</code> source code repository.
Add a new <code>&lt;release&gt;</code> block for the new release with the estimated release date.</p>
<p>Update the following files (e.g. the release date in <code>index.md</code>):</p>
<ul>
<li><code>content/_index.md</code></li>
<li><code>content/command-line.md</code></li>
<li><code>content/epsg.md</code> for EPSG dataset version</li>
<li><code>content/download.md</code> for SIS version and JAXB dependency</li>
<li><code>content/developer-guide/introduction/Installation.html</code></li>
</ul>
<p>Execute <code>hugo</code> and browse the documentation in the <code>public</code> repository.
If okay, commit and copy to staging repository:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git commit --message <span class="s2">&#34;Prepare documentation for the </span><span class="nv">$NEW_VERSION</span><span class="s2"> release.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Copy to staging repository</span>
</span></span><span class="line"><span class="cl">rm --recursive ../asf-staging/*
</span></span><span class="line"><span class="cl">mv public/.htaccess public/* ../asf-staging/
</span></span><span class="line"><span class="cl">rmdir public
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ../asf-staging/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Remove trailing whitespaces</span>
</span></span><span class="line"><span class="cl">find . -name <span class="s2">&#34;*.html&#34;</span> -type f -exec sed -i <span class="s1">&#39;s/[[:space:]]*$//&#39;</span> <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</span></span><span class="line"><span class="cl">find . -name <span class="s2">&#34;*.xml&#34;</span> -type f -exec sed -i <span class="s1">&#39;s/[[:space:]]*$//&#39;</span> <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Commit</span>
</span></span><span class="line"><span class="cl">git add --all
</span></span><span class="line"><span class="cl">git commit --message <span class="s2">&#34;Staging repository for the </span><span class="nv">$NEW_VERSION</span><span class="s2"> release.&#34;</span>
</span></span><span class="line"><span class="cl">git push
</span></span></code></pre></div><p>The new web site will be published in the <a href="https://sis.staged.apache.org/">staging area</a>.
It will not yet be published on <code>https://sis.apache.org</code>.</p>
<h1 id="vote">Put the release candidate up for a vote   </h1>
<ul>
<li>Create a VOTE email thread on <code>dev@</code> to record votes as replies.
A template is available <a href="templates/release-vote.html">here</a>.</li>
<li>Create a DISCUSS email thread on <code>dev@</code> for any vote questions.
A template is available <a href="templates/release-discuss.html">here</a>.</li>
<li>Perform a review of the release and cast your vote:</li>
<li>a -1 vote does not necessarily mean that the vote must be redone, however it is usually a good idea
to rollback the release if a -1 vote is received. See <em>Recovering from a vetoed release</em> below.</li>
<li>After the vote has been open for at least 72 hours, has at least three +1 PMC votes and no -1 votes,
then post the results to the vote thread:
<ul>
<li>Reply to the initial email and prepend to the original subject &ldquo;[RESULT]&rdquo;</li>
<li>Include a list of everyone who voted +1, 0 or -1.</li>
</ul>
</li>
</ul>
<h2 id="veto">Recovering from a vetoed release   </h2>
<p>Reply to the initial vote email and prepend to the original subject:</p>
<pre tabindex="0"><code>[CANCELED]
</code></pre><p>Delete the svn tag created by the release:perform step:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">svn delete https://svn.apache.org/repos/asf/sis/tags/<span class="nv">$NEW_VERSION</span> --message <span class="s2">&#34;deleting tag from rolled back release&#34;</span>
</span></span></code></pre></div><p>Drop the Nexus staging repository:</p>
<ul>
<li>Go to <a href="https://repository.apache.org/index.html">Nexus repository</a> → <em>Build Promotion</em> → <em>Staging repositories</em> and search for <code>org.apache.sis</code> in the <em>Repository</em> column.</li>
<li>Right click on the closed staging repositories (<code>org.apache.sis-&lt;id&gt;</code>) and select <em>Drop</em>.</li>
</ul>
<p>Make the required updates that caused the vote to be canceled during the release cycle.</p>
<h1 id="finalize">Finalize the release   </h1>
<p>The artificats in the repository are not yet mirrored and available for Maven to download.
Promote the staged Nexus artifacts, by releasing them.</p>
<ul>
<li>Go to <a href="https://repository.apache.org/index.html">Nexus repository</a> → <em>Build Promotion</em> → <em>Staging repositories</em> and search for <code>org.apache.sis</code> in the <em>Repository</em> column.</li>
<li>Click the checkboxes of the closed staging repositories (<code>org.apache.sis-&lt;id&gt;</code>) and press <em>Release</em> in the menu bar.</li>
</ul>
<p>Check in the source and binary artifacts into distribution svn which will be pulled by all mirrors within 24 hours.
The <code>dist/dev</code> svn is not mirrored, but the <code>dist/release</code> is.
From any directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">svn move https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>         https://dist.apache.org/repos/dist/release/sis/<span class="nv">$NEW_VERSION</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --message <span class="s2">&#34;Committing SIS Source and Binary Release Candidate </span><span class="nv">$RELEASE_CANDIDATE</span><span class="s2"> for SIS-</span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">svn delete https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --message <span class="s2">&#34;Delete SIS </span><span class="nv">$NEW_VERSION</span><span class="s2"> staging repository after release.&#34;</span>
</span></span></code></pre></div><p>Verify release signatures.
Download all source and binary artifacts into a new directory, then execute in that directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">find . -name <span class="s2">&#34;*.asc&#34;</span> -exec gpg --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</span></span></code></pre></div><p>The output shall report only good signatures.</p>
<h2 id="update-other-web-sites-jira-github-wiki">Update other web sites (JIRA, GitHub, Wiki):</h2>
<ul>
<li>Update the <a href="https://issues.apache.org/jira/browse/SIS">JIRA</a>:
<ul>
<li>Update the versions to mark the version as &ldquo;released&rdquo;.</li>
<li>Set the date to the date that the release was approved.</li>
<li>Make a new release entry in JIRA for the next release.</li>
</ul>
</li>
<li>Create a new <a href="https://github.com/apache/sis/releases">GitHub release</a>.</li>
<li>Update the <a href="https://cwiki.apache.org/confluence/display/SIS/Roadmap">Roadmap</a> wiki page.</li>
</ul>
<h2 id="announce">Announce the release   </h2>
<ul>
<li>WAIT 24 hours after committing releases for mirrors to replicate.</li>
<li>Publish the web site updates:
<ul>
<li>On the <code>asf-site</code> branch, execute <code>git merge asf-staging</code> and push.</li>
</ul>
</li>
<li>Make an announcement about the release on the <code>dev@</code>, <code>users@</code>, and <code>announce@</code> mailing lists.
A template is available <a href="templates/release-announce.html">here</a>.
The email needs to be sent from an <code>@apache.org</code> email address
and the message format must be RAW text only (no HTML).</li>
</ul>
<p>Delete the prior version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">svn delete https://dist.apache.org/repos/dist/release/sis/<span class="nv">$OLD_VERSION</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --message <span class="s2">&#34;Archive SIS-</span><span class="nv">$OLD_VERSION</span><span class="s2"> after release of SIS-</span><span class="nv">$NEW_VERSION</span><span class="s2">.&#34;</span>
</span></span></code></pre></div><h1 id="next-release">Update main branch for the next development cycle   </h1>
<p>On the <code>main</code> branch:</p>
<ul>
<li>Search for all occurrences of <code>SNAPSHOT</code> and update the version number.</li>
<li>Edit the value of the <code>MAJOR_VERSION</code> or <code>MINOR_VERSION</code> constant in the
<code>endorsed/src/org.apache.sis.util/main/org/apache/sis/system/Modules.java</code> file.</li>
</ul>
<h2 id="nexus-clean">Delete old artifacts on Maven snapshot repository   </h2>
<p>Login in the <a href="https://repository.apache.org/index.html">Nexus repository</a>.
In the <em>Repositories</em> tag, select <em>Snapshots</em> of type <em>hosted</em>
(not to be confused with <em>Snapshots</em> of type <em>group</em>).
Delete the whole <code>org/apache/sis</code> directory.
It will be recreated the next time that <a href="https://ci-builds.apache.org/job/SIS/">Jenkins</a> is run.</p>


          </article>
        </main>
        <footer>
          <div class="container">
            <p>Copyright &copy; 2013-2025 The Apache Software Foundation, Licensed under the
            <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
            Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
          </div>
        </footer>
      </div>
    </div>
  </body>
</html>
