<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Release management</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="http://www.apache.org/css/code.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/sis.css">

    

    
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License.  You may obtain a copy of the License at . http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the specific language governing permissions and limitations under the License. -->
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/index.html"> Apache SIS&trade;</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org/licenses/">License</a></li>
                  <li><a href="mail-lists.html">Mailing Lists</a></li>
                  <li><a href="team-list.html">Project Team</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="book/index.html">Developer guide</a></li>
                  <li><a href="apidocs/index.html">Online Javadoc</a></li>
                  <li><a href="downloads.html">Downloads</a></li>
                  <li><a href="source.html">Source Code</a></li>
                  <li><a href="code-patterns.html">Code patterns</a></li>
                  <li><a href="faq.html">FAQ</a></li>
                  <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org">The Foundation</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!-- /.nav-collapse -->
        </div><!-- /.container -->
      </div><!-- /.navbar-inner -->
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <div class="apache-con">
            <a href="https://www.apache.org/events/current-event.html">
              <img src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
            </a>
          </div>
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li><a href="index.html">Home</a></li>
              <li><a href="http://www.apache.org/licenses/">License</a></li>
              <li><a href="mail-lists.html">Mailing Lists</a></li>
              <li><a href="team-list.html">Project Team</a></li>
              <li class="nav-header">Project Documentation</li>
              <li><a href="book/index.html">Developer guide</a></li>
              <li><a href="apidocs/index.html">Online Javadoc</a></li>
              <li><a href="downloads.html">Downloads</a></li>
              <li><a href="source.html">Source Code</a></li>
              <li><a href="code-patterns.html">Code patterns</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
              <li class="nav-header">ASF</li>
              <li><a href="http://www.apache.org">The Foundation</a></li>
              <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
              <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="http://www.apache.org/security/">Security</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span10">
          <section id="content" class="row">
            <article class="span12">
              <img src="img/logo.png" class="sis-logo" align="left"/>
              <p class="page-title">Release management</p>
              <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>This page describes how to create and deploy the SIS Maven artifacts, binary bundle, javadoc and list of API changes.
The <a href="http://www.apache.org/dev/release.html">Release FAQ</a> page describes the foundation wide policies.
The instructions on this page provide a summary suitable to SIS releases, together with SIS-specific steps.
The intended audiences are SIS release managers.</p>
<div class="toc">
<ul>
<li><a href="#configure">Configure</a><ul>
<li><a href="#directory-layout">Directory layout</a></li>
<li><a href="#java-version">Java versions</a></li>
</ul>
</li>
<li><a href="#prepare-source">Prepare web site and source code before branching</a><ul>
<li><a href="#release-notes">Prepare release notes</a></li>
<li><a href="#prepare-website">Web site</a></li>
<li><a href="#test-master">Test master extensively</a></li>
<li><a href="#prepare-code">Source code</a></li>
</ul>
</li>
<li><a href="#branch">Create branch and tag</a><ul>
<li><a href="#tag">Tag the branch</a></li>
<li><a href="#branch-verify">Verify content</a></li>
</ul>
</li>
<li><a href="#maven-deploy">Deploy Maven artifacts</a><ul>
<li><a href="#nexus-close">Verify and close the Nexus release artifacts</a></li>
<li><a href="#maven-nonfree">Deploy non-free resources to Nexus</a></li>
<li><a href="#nexus-text">Test the Nexus release artifacts</a></li>
</ul>
</li>
<li><a href="#stage">Stage the source, binary and javadoc artifacts</a><ul>
<li><a href="#dist">Initialize the distribution directory</a></li>
<li><a href="#sign">Sign and commit</a></li>
<li><a href="#apidocs">Update online Javadoc</a></li>
<li><a href="#test">Test the release</a></li>
</ul>
</li>
<li><a href="#openoffice">Prepare OpenOffice add-in</a></li>
<li><a href="#vote">Put the release candidate up for a vote</a><ul>
<li><a href="#veto">Recovering from a vetoed release</a></li>
</ul>
</li>
<li><a href="#finalize">Finalize the release</a><ul>
<li><a href="#verify">Verify release signatures</a></li>
<li><a href="#announce">Announce the release</a></li>
</ul>
</li>
<li><a href="#next-release">Update master for the next development cycle</a><ul>
<li><a href="#nexus-clean">Delete old artifacts on Maven snapshot repository</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h1>
<p>Before to perform a release, make sure that the following conditions hold:</p>
<ul>
<li>Commands will be executed in a Unix shell.</li>
<li>Subversion, GNU GPG, ZIP, Maven, Ant, Java and the Java compiler are available on the path.</li>
<li>The <a href="release-management-setup.html">release management setup</a> steps have been executed once.</li>
</ul>
<p>For all instructions in this page, <code>$OLD_VERSION</code> and <code>$NEW_VERSION</code> stand for the version
number of the previous and the new release respectively, and <code>$RELEASE_CANDIDATE</code> stands for
the current release attempt. Those versions shall be set on the command line like below (Unix):</p>
<div class="codehilite"><pre><span class="nb">export </span><span class="nv">OLD_VERSION</span><span class="o">=</span>0.8
<span class="nb">export </span><span class="nv">NEW_VERSION</span><span class="o">=</span>1.0
<span class="nb">export </span><span class="nv">RELEASE_CANDIDATE</span><span class="o">=</span>1
<span class="nb">export </span><span class="nv">SIGNING_KEY</span><span class="o">=</span>&lt;your key ID&gt;
<span class="nb">export </span><span class="nv">BOOTCLASSPATH</span><span class="o">=</span>&lt;path to the rt.jar file of a JDK7 installation&gt;
</pre></div>


<p>The key ID value is an hexadecimal numbers with 8 digits (may be the last 8 digits of a 40 digits number).
It can be found be executing <code>gpg --list-keys</code>.</p>
<p>The boot class path value is highly system-dependent. Some examples are:</p>
<ul>
<li><code>/usr/lib/jvm/java-7/jre/lib/rt.jar</code> on some Linux distributions (replace <code>java-7</code> by the actual directory name).</li>
<li><code>/Library/Java/JavaVirtualMachines/jdk1.7.0_79.jdk/Contents/Home/jre/lib/rt.jar</code> on MacOS.</li>
</ul>
<p>Starts the GPG agent if not already done.
This is for avoiding to be prompted many time for the passphrase in every modules to be built by Maven.</p>
<div class="codehilite"><pre><span class="nb">eval</span> <span class="k">$(</span>gpg-agent --daemon<span class="k">)</span>
</pre></div>


<h2 id="directory-layout">Directory layout<a class="headerlink" href="#directory-layout" title="Permanent link">&para;</a></h2>
<p>The steps described in this page assume the following directory layout (some directories will be created as
a result of the steps). Any other layout can be used. However if the layout differs, then the relative paths
in this page shall be adjusted accordingly.</p>
<div class="codehilite"><pre>&lt;any root directory for SIS&gt;
├─ master
├─ branches
│  └─ $NEW_VERSION
├─ tags
│  └─ $NEW_VERSION
│     └─ target
│        └─ distributions
├─ non-free
│  └─ sis-epsg
├─ distribution
│  └─ $NEW_VERSION
│     └─ RC$RELEASE_CANDIDATE
└─ site
   └─ content
      └─ apidocs
</pre></div>


<h2 id="java-version">Java versions<a class="headerlink" href="#java-version" title="Permanent link">&para;</a></h2>
<p>While we need a JDK7 installation for the <code>bootclasspath</code> option, we do not recommend to use it for generating
the binaries since JDK7 has reached its end of public updates (but not the end of commercial support).
We recommend to create the release with JDK8 instead (note however that JDK8 <code>javadoc</code> tool seems to have a bug that prevent its use with SIS).
Make sure that the JDK installation to be used for the release has been updated recently, since compilers may receive critical bug fixes.
For example the <code>javadoc</code> tool of older JDK versions was known to generate HTML pages with a vulnerability in them.</p>
<h1 id="prepare-source">Prepare web site and source code before branching<a class="headerlink" href="#prepare-source" title="Permanent link">&para;</a></h1>
<p>Before to start the release process, we need to test more extensively the master.
The tests described below often reveal errors that were unnoticed in daily builds.
It is better to detect and fix them before to create the branch.
First:</p>
<ul>
<li>Review and update the <code>README</code> and <code>NOTICE</code> files on the source code repository.</li>
<li>Review the <code>javac</code> and <code>javadoc</code> warnings reported by Jenkins and fix at least the typos.</li>
</ul>
<h2 id="release-notes">Prepare release notes<a class="headerlink" href="#release-notes" title="Permanent link">&para;</a></h2>
<p>We update JIRA first because doing so is sometime a reminder of uncompleted tasks in source code.
Update <a href="http://issues.apache.org/jira/browse/SIS">JIRA</a> tasks and prepare release notes as below:</p>
<ul>
<li>Ensure that the <em>Fix Version</em> in issues resolved since the last release includes this release version correctly.</li>
<li>Ensure that all open issues are resolved or closed before proceeding further.</li>
<li>On the <code>site</code> source code repository, create a <code>content/release-notes/$NEW_VERSION.html</code> file with all the features added.</li>
<li>Use <code>content/release-notes/$OLD_VERSION.html</code> as a template, omitting everything between the <code>&lt;body&gt;</code> and <code>&lt;/body&gt;</code> tags.</li>
<li>The release notes can be obtained from JIRA, by clicking on the <em>Roadmap</em> tab → the version number → <em>Release notes</em>
    and then configuring the release notes to display HTML format and copying it.
    A suggested approach would be to reorganize the release notes as
    <em>New Features</em>, then <em>Improvements</em>, then <em>Bug Fixes</em>, then <em>Tests</em> and finally <em>Tasks</em>.
    The <em>Sub Tasks</em> can be classified according the category of their parent issue.</li>
</ul>
<h2 id="prepare-website">Web site<a class="headerlink" href="#prepare-website" title="Permanent link">&para;</a></h2>
<p>Review and update the <code>content/DOAP.rdf</code> file on the <code>site</code> source code repository.
Add a new <code>&lt;release&gt;</code> block for the new release with the estimated release date.</p>
<p>Update the version numbers from the old one to <code>$NEW_VERSION</code> in the following files.</p>
<ul>
<li><code>content/index.mdtext</code></li>
<li><code>content/gdal.mdtext</code></li>
<li><code>content/downloads.mdtext</code> (need also to update <code>$NEW_VERSION-SNAPSHOT</code> to the next snapshot version)</li>
<li><code>content/command-line.mdtext</code></li>
<li><code>content/epsg.mdtext</code> (be aware that the version number may sometime be behind the SIS version number)</li>
</ul>
<p>Commit:</p>
<div class="codehilite"><pre>svn add content/release-notes/<span class="nv">$NEW_VERSION</span>.html
svn commit --message <span class="s2">&quot;Prepare documentation for the $NEW_VERSION release.&quot;</span>
</pre></div>


<p>The new web site will be published in the <a href="http://sis.staging.apache.org">staging area</a>.
It will not yet be published on <code>http://sis.apache.org</code>.</p>
<h2 id="test-master">Test master extensively<a class="headerlink" href="#test-master" title="Permanent link">&para;</a></h2>
<p>Build the project with the <code>apache-release</code> profile enabled.
This profile performs the following actions:</p>
<ul>
<li>Enable extensive tests (i.e. it will set the <code>org.apache.sis.test.extensive</code> property to <code>true</code>).</li>
<li>Generate Javadoc. This may fail if the source code contains invalid Javadoc tags or broken HTML.</li>
<li>Generate additional binary artifacts (<code>*.zip</code> and <code>*.oxt</code> files).
    This will fail if duplicated class files or resources are found.
    Consequently building the <code>*.zip</code> file is an additional test worth to do before deployment.</li>
<li>Sign the artifacts.</li>
</ul>
<p>Each of those additional products may cause a failure that did not happen in normal builds.</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../master
mvn clean install --activate-profiles apache-release --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<p>Verify signature for all files:</p>
<div class="codehilite"><pre>find . -name <span class="s2">&quot;sis-*.asc&quot;</span> -exec gpg --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</pre></div>


<p>If the <code>SIS_DATA</code> environment variable was set during above build, unset it a try again.
Ideally the build should be tested in both conditions (<code>SIS_DATA</code> set and unset).</p>
<p>Build the <code>non-free</code> group of modules. Those modules will not be part of the distribution (except on Maven),
but we nevertheless need to ensure that they work. Before to test, verify that their version numbers and their
SIS dependencies are the snapshot tested in this section.</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../non-free
svn update
mvn clean install --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<p>Run the integration tests. Before to test,
verify that their version numbers and their SIS dependencies are the snapshot tested in this section.
Note that execution of those tests may be slow.</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../release-test
svn update
<span class="nb">cd </span>maven
mvn clean <span class="nb">test</span> --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<h2 id="prepare-code">Source code<a class="headerlink" href="#prepare-code" title="Permanent link">&para;</a></h2>
<p>Replace the <code>$OLD_VERSION</code> number by <code>$NEW_VERSION</code> in the following literals.
Those changes need to be applied on the development branch and merged with all other branches and master.</p>
<ul>
<li><code>DOWNLOAD_URL</code> in <code>application/sis-console/src/main/java/org/apache/sis/console/ResourcesDownloader.java</code> file.</li>
<li><code>&lt;sis.non-free.version&gt;</code> in root <code>pom.xml</code> file.</li>
</ul>
<p>Commit and merge to other branches and to master.</p>
<div class="codehilite"><pre>git commit --message <span class="s2">&quot;Set the EPSG geodetic dataset URL to its expected location after release.&quot;</span>
git checkout geoapi-3.1
git merge
<span class="c"># Repeat the above commit and the merge commands for other branches until the changes are merged to master.</span>
</pre></div>


<h1 id="branch">Create branch and tag<a class="headerlink" href="#branch" title="Permanent link">&para;</a></h1>
<p>Execute the following command:</p>
<div class="codehilite"><pre>git checkout -b <span class="nv">$NEW_VERSION</span>
</pre></div>


<p>It is okay to checkout the branch in a separated directory if desired.
The <code>BRANCH_DIR</code> environment variable will specify that directory.</p>
<div class="codehilite"><pre><span class="nb">export </span><span class="nv">BRANCH_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</pre></div>


<p>We need to update the SIS version numbers not only in the <code>pom.xml</code> files,
but also in a few Java files. The following command performs the replacement using Ant.
Note that this command does <em>not</em> yet remove the <code>-SNAPSHOT</code> suffix in version numbers
(this will be done later, at tag creation time):</p>
<div class="codehilite"><pre>ant -buildfile core/sis-build-helper/src/main/ant/prepare-release.xml branch -Dbranch.version<span class="o">=</span><span class="nv">$NEW_VERSION</span> -Dsis.version<span class="o">=</span><span class="nv">$NEW_VERSION</span>
</pre></div>


<p>Open the root <code>pom.xml</code> file in an editor and perform the following changes:</p>
<ul>
<li>Remove the whole <code>&lt;pluginRepositories&gt;</code> block (including comment), since it should not be needed for releases (and is actually not allowed).</li>
</ul>
<p>Remove the modules that are not yet ready for a release.
This may require removing <code>&lt;module&gt;</code> elements in the parent <code>pom.xml</code> file.</p>
<div class="codehilite"><pre>git rm storage/sis-shapefile
git rm application/sis-javafx
</pre></div>


<p>Validate with <code>git diff</code>, ensure that the build is not broken (we will run the tests later),
then commit the changes on the branch:</p>
<div class="codehilite"><pre>mvn clean package --define <span class="nv">skipTests</span><span class="o">=</span><span class="nb">true</span> --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
git commit --message <span class="s2">&quot;Prepare branch for $NEW_VERSION release.&quot;</span>
</pre></div>


<h2 id="tag">Tag the branch<a class="headerlink" href="#tag" title="Permanent link">&para;</a></h2>
<p>In theory, the next commands would be a real (non-dry) run of <code>mvn release:prepare</code>, followed by <code>mvn release:perform</code>.
However we perform those steps manually rather than relying on Maven for the following reasons:</p>
<ul>
<li>Perform some additional changes on the tag.</li>
<li>Give more opportunities to take action before commit in case of problems.</li>
<li>We need a separated <code>install</code> phase first, for proper installation of <code>sis-build-helper</code> plugin.</li>
</ul>
<p>First, create the tag:</p>
<div class="codehilite"><pre>git tag <span class="nv">$NEW_VERSION</span>
</pre></div>


<p>It is okay to checkout the tag in a separated directory if desired.
The <code>TAG_DIR</code> environment variable will specify that directory.</p>
<div class="codehilite"><pre><span class="nb">export </span><span class="nv">TAG_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</pre></div>


<p>Update versions number in <code>pom.xml</code> files (like what <code>mvn release:prepare</code> would have done),
plus some additional files:</p>
<div class="codehilite"><pre>ant -buildfile core/sis-build-helper/src/main/ant/prepare-release.xml tag -Dbranch.version<span class="o">=</span><span class="nv">$NEW_VERSION</span> -Dsis.version<span class="o">=</span><span class="nv">$NEW_VERSION</span>
</pre></div>


<p>Validate with <code>git diff</code>, search <code>SNAPSHOT</code> in the whole source directory in case we missed some, then commit:</p>
<div class="codehilite"><pre>git commit --message <span class="s2">&quot;Fix version number to $NEW_VERSION (no -SNAPSHOT).&quot;</span>
</pre></div>


<h2 id="branch-verify">Verify content<a class="headerlink" href="#branch-verify" title="Permanent link">&para;</a></h2>
<p>Build and test the project in the same way than we did on master.
In addition to testing, execution of an <code>install</code> phase before deployment is required for our custom <code>sis-build-helper</code> plugin.</p>
<div class="codehilite"><pre>mvn install --activate-profiles apache-release --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
find . -name <span class="s2">&quot;sis-*.asc&quot;</span> -exec gpg --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</pre></div>


<p>Open the <code>pom.xml</code> file of all modules in the <code>non-free</code> group.
Set their version numbers and their SIS dependencies to <code>$NEW_VERSION</code> without <code>-SNAPSHOT</code> suffix.
Commit and built:</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../../non-free
svn commit --message <span class="s2">&quot;Set version number and dependencies to $NEW_VERSION.&quot;</span>
mvn clean install --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<p>Open the <code>pom.xml</code> file of integration tests.
Set its version numbers and its SIS dependencies to <code>$NEW_VERSION</code> without <code>-SNAPSHOT</code> suffix.
Commit and built (note that execution may be slow).</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../release-test
svn commit --message <span class="s2">&quot;Set version number and dependencies to $NEW_VERSION.&quot;</span>
<span class="nb">cd </span>maven
mvn clean <span class="nb">test</span> --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<h1 id="maven-deploy">Deploy Maven artifacts<a class="headerlink" href="#maven-deploy" title="Permanent link">&para;</a></h1>
<p>If above verifications succeeded, deploy:</p>
<div class="codehilite"><pre>chmod a-w target/distribution/*.zip
mvn deploy --activate-profiles apache-release --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<h2 id="nexus-close">Verify and close the Nexus release artifacts<a class="headerlink" href="#nexus-close" title="Permanent link">&para;</a></h2>
<p>Verify the staged artifacts in the <a href="https://repository.apache.org/index.html">Nexus repository</a>.
The artifacts can be found under <em>Build Promotion</em> → <em>Staging repositories</em>, and searching for <code>org.apache.sis</code> in the <em>Repository</em> column.
Navigate through the artifact tree and make sure that all javadoc, source, test and jar files have <code>.asc</code> (GPG signature) and <code>.md5</code> files.</p>
<p>Additional references about signatures:</p>
<ul>
<li><a href="http://people.apache.org/~henkp/repo/faq.html">Maven repository PGP signature checker FAQ</a></li>
<li><a href="http://www.apache.org/dev/release-signing.html">Release signing</a> (cited in the <a href="release-management-setup.html">Release setup</a> page)</li>
</ul>
<p>Select any <code>*-javadoc.jar</code> file and click on the <cite>Archive Browser</cite> tab on the right side.
Select any <code>*.html</code> file which is known to use some of the custom taglets defined in the <code>sis-build-helper</code> module.
Click on that file and verify that the custom elements are rendered properly.
In particular, all Java code snippets are missing if the <code>@preformat</code> taglet had not be properly registered,
so try to see at least one code snippet.</p>
<p>Additional cleaning:</p>
<ul>
<li>Delete all <code>org/apache/sis/parent/$NEW_VERSION/parent-$NEW_VERSION-source-release.zip.*</code> files on the Nexus repository.
    They should not be there - source release will be deployed on an other repository later.</li>
</ul>
<p>Close the Nexus staging repository:</p>
<ul>
<li>Click the checkboxes for the open staging repositories (<code>org.apache.sis-&lt;id&gt;</code>) and press <em>Close</em> in the menu bar.</li>
<li>In the description field, enter "<code>SIS $NEW_VERSION-RC$RELEASE_CANDIDATE</code>"
    (replace <code>$NEW_VERSION</code> and <code>$RELEASE_CANDIDATE</code> by appropriate values.
    This will not be done automatically since this field box is not our bash shell!).</li>
<li>Click on the <code>org.apache.sis-&lt;id&gt;</code> link in order to get the URL to the temporary Maven repository created by Nexus.</li>
</ul>
<p>We will announce later (in the <cite>Put the release candidate up for a vote</cite> section) on the <code>dev@</code> mailing list
the availability of this temporary repository for testing purpose.</p>
<h2 id="maven-nonfree">Deploy non-free resources to Nexus<a class="headerlink" href="#maven-nonfree" title="Permanent link">&para;</a></h2>
<p>We deploy the non-free resources in a separated Nexus repository for allowing deployment of those resources to Maven Central
before deployment of the rest of Apache SIS. This allows to test that the URL to those resources in Apache SIS are correct.</p>
<p>Go to the directory that contains a checkout of <code>https://svn.apache.org/repos/asf/sis/data/non-free/sis-epsg</code>.
Replace occurrences of <code>&lt;version&gt;$OLD_VERSION&lt;/version&gt;</code> by <code>&lt;version&gt;$NEW_VERSION&lt;/version&gt;</code> in the root <code>pom.xml</code>.
Deploy:</p>
<div class="codehilite"><pre>mvn deploy --activate-profiles apache-release --define <span class="nv">bootclasspath</span><span class="o">=</span><span class="nv">$BOOTCLASSPATH</span>
</pre></div>


<p>In Nexus:</p>
<ul>
<li>Delete all <code>*-source-release.zip.*</code> files since they duplicate the <code>*-source.zip.*</code> files.</li>
<li>In the <code>sis-epsg-$NEW_VERSION.jar</code> file, verify that <code>META-INF/LICENSE</code> contain the EPSG terms of use.</li>
<li>Close the repository and take note of its URL.</li>
</ul>
<h2 id="nexus-text">Test the Nexus release artifacts<a class="headerlink" href="#nexus-text" title="Permanent link">&para;</a></h2>
<p>Go to the test Maven project.
Open the root <code>pom.xml</code> file and set the <code>&lt;version&gt;</code> number to the SIS release to be tested.
Then go to the <code>&lt;url&gt;</code> declaration of the first <code>&lt;repository&gt;</code> and replace value by the URL
of the temporary Maven repository created by Nexus.
Usually, only the 3 last digits need to be updated.</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../../release-test/maven
vim pom.xml
mvn compile
svn commit -m <span class="s2">&quot;Test project for SIS $NEW_VERSION-RC$RELEASE_CANDIDATE&quot;</span>
</pre></div>


<p>Create a temporary directory where Apache SIS will write the EPSG dataset.</p>
<div class="codehilite"><pre>mkdir target/SpatialMetadata
<span class="nb">export </span><span class="nv">SIS_DATA</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/target/SpatialMetadata
</pre></div>


<p>Clear the local Maven repository in order to force downloads from the Nexus repository, then test.
This will also verify the checksums.</p>
<div class="codehilite"><pre>rm -r ~/.m2/repository/org/apache/sis
mvn package --strict-checksums
</pre></div>


<p>Verify that the EPSG dataset has been created, then cleanup:</p>
<div class="codehilite"><pre>ll <span class="nv">$SIS_DATA</span>
mvn clean
</pre></div>


<h1 id="stage">Stage the source, binary and javadoc artifacts<a class="headerlink" href="#stage" title="Permanent link">&para;</a></h1>
<p>Generate the Javadoc. While not mandatory, we suggest to use JDK 8 or above for getting the new look and feel,
getting the Javadoc enhancements expected in future JDK releases (more dynamic pages),
avoiding the security vulnerability discovered in the Javadoc tools of older JDK releases,
and keeping the <code>diff</code> smaller on the SVN repository of SIS web site.
If JDK8 is <em>not</em> used, then omit the <code>cp</code> command below.</p>
<div class="codehilite"><pre><span class="nb">cd</span> <span class="nv">$TAG_DIR</span>
mvn javadoc:aggregate
<span class="nb">cd </span>target/site
zip -9 -r apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip apidocs
<span class="nb">cd</span> ../..
</pre></div>


<p>Note: if Javadoc fails because of <a href="https://bugs.openjdk.java.net/browse/JDK-8061305">JDK-8061305</a> bug,
a workaround is to temporarily copy the OpenGIS annotations into the <code>sis-metadata</code> module
(only the time needed for building the javadoc):</p>
<div class="codehilite"><pre>mkdir core/sis-metadata/src/main/java/org/opengis
<span class="nb">cd </span>core/sis-metadata/src/main/java/org/opengis
ln -s &lt;path to GeoAPI project&gt;/geoapi/src/main/java/org/opengis/annotation
<span class="nb">cd</span> -
</pre></div>


<h2 id="dist">Initialize the distribution directory<a class="headerlink" href="#dist" title="Permanent link">&para;</a></h2>
<p>Create the directory for the new version and release candidate within the distribution directory.
The <code>$RELEASE_CANDIDATE</code> variable shall be the number of current release attempt.</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../../distribution
svn update
mkdir -p <span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>
svn add <span class="nv">$NEW_VERSION</span>
<span class="nb">cd</span> <span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>
<span class="nb">export </span><span class="nv">DIST_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</pre></div>


<p>Copy the <code>HEADER.html</code> file from the previous release.
Update the file content if necessary.</p>
<div class="codehilite"><pre>svn copy https://dist.apache.org/repos/dist/release/sis/<span class="nv">$OLD_VERSION</span>/HEADER.html .
</pre></div>


<p>Move the files generated by Maven to the distribution directory:</p>
<div class="codehilite"><pre>mv <span class="nv">$TAG_DIR</span>/target/sis-<span class="nv">$NEW_VERSION</span>-* .
mv <span class="nv">$TAG_DIR</span>/target/site/apache-sis-<span class="nv">$NEW_VERSION</span>-* .
mv <span class="nv">$TAG_DIR</span>/application/sis-console/target/distribution/apache-sis-<span class="nv">$NEW_VERSION</span>.zip .
</pre></div>


<p>Rename the files to something more conform to the convention seen in other Apache projects:</p>
<div class="codehilite"><pre>mv apache-sis-<span class="nv">$NEW_VERSION</span>.zip             apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
mv sis-<span class="nv">$NEW_VERSION</span>-source-release.zip     apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip
mv sis-<span class="nv">$NEW_VERSION</span>-source-release.zip.asc apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.asc
</pre></div>


<h2 id="sign">Sign and commit<a class="headerlink" href="#sign" title="Permanent link">&para;</a></h2>
<p>Sign the source, javadoc and binary artifacts:</p>
<div class="codehilite"><pre>shasum --algorithm 512 apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.sha
md5sum                 apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.md5

gpg --use-agent --armor --detach-sign --default-key <span class="nv">$SIGNING_KEY</span> apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip
shasum --algorithm 512 apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip.sha
md5sum                 apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip.md5

gpg --use-agent --armor --detach-sign --default-key <span class="nv">$SIGNING_KEY</span> apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
shasum --algorithm 512 apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.sha
md5sum                 apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip &gt; apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.md5
</pre></div>


<p>Verify checksums and signatures:</p>
<div class="codehilite"><pre>find . -name <span class="s2">&quot;*.md5&quot;</span> -exec md5sum --check <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
find . -name <span class="s2">&quot;*.sha&quot;</span> -exec shasum --check <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
find . -name <span class="s2">&quot;*.asc&quot;</span> -exec gpg --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</pre></div>


<p>Commit:</p>
<div class="codehilite"><pre>svn add apache-sis-<span class="nv">$NEW_VERSION</span>-*
<span class="nb">cd</span> ../..
svn commit --message <span class="s2">&quot;SIS release candidate $RELEASE_CANDIDATE&quot;</span>
</pre></div>


<h2 id="apidocs">Update online Javadoc<a class="headerlink" href="#apidocs" title="Permanent link">&para;</a></h2>
<p>Copy the Javadoc to the web site staging directory:</p>
<div class="codehilite"><pre><span class="nb">cd</span> ../site/content
rm -r apidocs
unzip <span class="nv">$DIST_DIR</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-doc.zip
</pre></div>


<p>Execute <code>svn add</code> for new files and <code>svn remove</code> for deleted files:</p>
<div class="codehilite"><pre><span class="nb">cd </span>apidocs
svn status | gawk <span class="s1">&#39;/^\?.*/ {print $2}&#39;</span> | xargs svn add
svn status | gawk <span class="s1">&#39;/^\!.*/ {print $2}&#39;</span> | xargs svn remove
svn commit --message <span class="s2">&quot;Update javadoc for SIS $NEW_RELEASE.&quot;</span>
</pre></div>


<h2 id="test">Test the release<a class="headerlink" href="#test" title="Permanent link">&para;</a></h2>
<p>Execute the following commands in any temporary directory for testing the sources:</p>
<div class="codehilite"><pre>wget --no-check-certificate https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip <span class="se">\</span>
                            https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.asc
<span class="c"># Test</span>
gpg --verify apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip.asc
unzip apache-sis-<span class="nv">$NEW_VERSION</span>-src.zip
<span class="nb">cd </span>sis-<span class="nv">$NEW_VERSION</span>
mvn install
</pre></div>


<p>Execute the following commands in any temporary directory for testing the binary:</p>
<div class="codehilite"><pre>wget --no-check-certificate https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip <span class="se">\</span>
                            https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span>/apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.asc
<span class="c"># Test</span>
gpg --verify apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip.asc
unzip apache-sis-<span class="nv">$NEW_VERSION</span>-bin.zip
<span class="nb">cd </span>apache-sis-<span class="nv">$NEW_VERSION</span>
<span class="nb">unset </span>SIS_DATA
bin/sis about --verbose
bin/sis metadata https://github.com/opengeospatial/geoapi/raw/master/geoapi-netcdf/src/test/resources/org/opengis/wrapper/netcdf/NCEP-SST.nc
bin/sis crs http://svn.apache.org/repos/asf/sis/trunk/core/sis-referencing/src/test/resources/org/apache/sis/referencing/crs/ProjectedCRS.xml --format WKT
</pre></div>


<h1 id="openoffice">Prepare OpenOffice add-in<a class="headerlink" href="#openoffice" title="Permanent link">&para;</a></h1>
<p>The OpenOffice add-in source code can be distributed under Apache 2 license only.
But the binary may contain non-free resources, notably the EPSG geodetic dataset.
For now, the release manager should apply the following local modifications before
to build the add-in:</p>
<ul>
<li>Move to the <code>application/sis-openoffice</code> directory.</li>
<li>Replace the <code>src/main/unopkg/license.txt</code> file by EPSG terms of use.
    A copy is found in the <code>non-free</code> group of SIS modules.</li>
<li>Run <code>mvn package --activate-profiles non-free</code>.</li>
</ul>
<h1 id="vote">Put the release candidate up for a vote<a class="headerlink" href="#vote" title="Permanent link">&para;</a></h1>
<ul>
<li>Create a VOTE email thread on <code>dev@</code> to record votes as replies.
    A template is available <a href="templates/release-vote.txt">here</a>.</li>
<li>Create a DISCUSS email thread on <code>dev@</code> for any vote questions.
    A template is available <a href="templates/release-discuss.txt">here</a>.</li>
<li>Perform a review of the release and cast your vote:</li>
<li>a -1 vote does not necessarily mean that the vote must be redone, however it is usually a good idea
    to rollback the release if a -1 vote is received. See <em>Recovering from a vetoed release</em> below.</li>
<li>After the vote has been open for at least 72 hours, has at least three +1 PMC votes and no -1 votes,
    then post the results to the vote thread:<ul>
<li>Reply to the initial email and prepend to the original subject "[RESULT]"</li>
<li>Include a list of everyone who voted +1, 0 or -1.</li>
</ul>
</li>
</ul>
<h2 id="veto">Recovering from a vetoed release<a class="headerlink" href="#veto" title="Permanent link">&para;</a></h2>
<p>Reply to the initial vote email and prepend to the original subject:</p>
<div class="codehilite"><pre>[CANCELED]
</pre></div>


<p>Delete the svn tag created by the release:perform step:</p>
<div class="codehilite"><pre>svn delete https://svn.apache.org/repos/asf/sis/tags/<span class="nv">$NEW_VERSION</span> --message <span class="s2">&quot;deleting tag from rolled back release&quot;</span>
</pre></div>


<p>Drop the Nexus staging repository:</p>
<ul>
<li>Go to <a href="https://repository.apache.org/index.html">Nexus repository</a> → <em>Build Promotion</em> → <em>Staging repositories</em> and search for <code>org.apache.sis</code> in the <em>Repository</em> column.</li>
<li>Right click on the closed staging repositories (<code>org.apache.sis-&lt;id&gt;</code>) and select <em>Drop</em>.</li>
</ul>
<p>Make the required updates that caused the vote to be canceled during the release cycle.</p>
<h1 id="finalize">Finalize the release<a class="headerlink" href="#finalize" title="Permanent link">&para;</a></h1>
<p>The artificats in the repository are not yet mirrored and available for Maven to download.
Promote the staged Nexus artifacts, by releasing them.</p>
<ul>
<li>Go to <a href="https://repository.apache.org/index.html">Nexus repository</a> → <em>Build Promotion</em> → <em>Staging repositories</em> and search for <code>org.apache.sis</code> in the <em>Repository</em> column.</li>
<li>Click the checkboxes of the closed staging repositories (<code>org.apache.sis-&lt;id&gt;</code>) and press <em>Release</em> in the menu bar.</li>
</ul>
<p>Check in the source and binary artifacts into distribution svn which will be pulled by all mirrors within 24 hours.
The <code>dist/dev</code> svn is not mirrored, but the <code>dist/release</code> is.
From any directory:</p>
<div class="codehilite"><pre>svn move https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span>/RC<span class="nv">$RELEASE_CANDIDATE</span> <span class="se">\</span>
         https://dist.apache.org/repos/dist/release/sis/<span class="nv">$NEW_VERSION</span> <span class="se">\</span>
    --message <span class="s2">&quot;Committing SIS Source and Binary Release Candidate $RELEASE_CANDIDATE for SIS-$NEW_VERSION.&quot;</span>

svn delete https://dist.apache.org/repos/dist/dev/sis/<span class="nv">$NEW_VERSION</span> <span class="se">\</span>
    --message <span class="s2">&quot;Delete SIS $NEW_VERSION staging repository after release.&quot;</span>
</pre></div>


<p>Update <a href="http://issues.apache.org/jira/browse/SIS">JIRA</a>:</p>
<ul>
<li>Update the JIRA versions to mark the version as "released".</li>
<li>Set the date to the date that the release was approved.</li>
<li>Prepare for the next release:<ul>
<li>Make a new release entry in JIRA for the next release.</li>
<li>Update the <a href="https://cwiki.apache.org/confluence/display/SIS/Roadmap">Roadmap</a> wiki page.</li>
</ul>
</li>
</ul>
<h2 id="verify">Verify release signatures<a class="headerlink" href="#verify" title="Permanent link">&para;</a></h2>
<p>Download all source and binary artifacts into a new directory, then execute in that directory:</p>
<div class="codehilite"><pre>find . -name <span class="s2">&quot;*.asc&quot;</span> -exec gpg --verify <span class="s1">&#39;{}&#39;</span> <span class="se">\;</span>
</pre></div>


<p>The output shall report only good signatures.</p>
<h2 id="announce">Announce the release<a class="headerlink" href="#announce" title="Permanent link">&para;</a></h2>
<ul>
<li>WAIT 24 hours after committing releases for mirrors to replicate.</li>
<li>Publish the web site updates:<ul>
<li>Login to the <a href="https://cms.apache.org/sis/">ASF Content Management System</a>.</li>
<li>Click on <em>Publish sis site</em>.</li>
</ul>
</li>
<li>Make an announcement about the release on the <code>dev@</code>, <code>users@</code>, and <code>announce@</code> mailing lists.
    A template is available <a href="templates/release-announce.html">here</a>.
    The email needs to be sent from an <code>@apache.org</code> email address.</li>
</ul>
<p>Delete the prior version:</p>
<div class="codehilite"><pre>svn delete https://dist.apache.org/repos/dist/release/sis/<span class="nv">$OLD_VERSION</span> <span class="se">\</span>
    --message <span class="s2">&quot;Archive SIS-$OLD_VERSION after release of SIS-$NEW_VERSION.&quot;</span>
</pre></div>


<h1 id="next-release">Update master for the next development cycle<a class="headerlink" href="#next-release" title="Permanent link">&para;</a></h1>
<p>On the development branch (usually JDK8),
update the version numbers in the <code>pom.xml</code> files on master with the following command:</p>
<div class="codehilite"><pre>mvn clean
mvn release:update-versions --define <span class="nv">autoVersionSubmodules</span><span class="o">=</span><span class="nb">true</span>
</pre></div>


<p>This change will need to be merged manually on the JDK7 branch and on the master.
Then on the development branch:</p>
<ul>
<li>Edit the version number in the <code>application/sis-console/src/main/artifact/README</code> file.</li>
<li>Edit the value of the <code>MAJOR_VERSION</code> or <code>MINOR_VERSION</code> constant in the
    <code>core/sis-utility/src/main/java/org/apache/sis/internal/system/Modules.java</code> file.</li>
</ul>
<h2 id="nexus-clean">Delete old artifacts on Maven snapshot repository<a class="headerlink" href="#nexus-clean" title="Permanent link">&para;</a></h2>
<p>Login in the <a href="https://repository.apache.org/index.html">Nexus repository</a>. In the <em>Repositories</em> tag, select <em>Snapshots</em> of type <em>hosted</em>
(not to be confused with <em>Snapshots</em> of type <em>group</em>). Navigate to the <code>org/apache/sis</code> directory and delete
all directories starting with the old version number. The sub-directories need to be cleaned too.</p>
            </article>
          </section>
        </div><!--/span-->
      </div><!--/row-fluid-->
    </div><!--/container-fluid-->

  <footer class="footer">
    <div class="container">
      <p>Copyright &copy; 2013-2018 The Apache Software Foundation, Licensed under the
        <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br />
          Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
    </div>
  </footer>

  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <!-- for marking links as active in the navbar-menu -->
  <script type="text/javascript">
    var pathname = this.location.pathname;
    pathname = pathname.substring(1, pathname.length);
    var link = $('a[href="' + pathname + '"]');
    if (link != undefined)
      link.parents('li,ul').addClass('active');
  </script>

</body>
</html>
