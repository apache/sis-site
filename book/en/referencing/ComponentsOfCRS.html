<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>

<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>ComponentsOfCRS</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="../../../content/book/book.css"/>
  </head>
  <body>
    <!--
      Content below this point is copied in "(…)/content/book/en/developer-guide.html" file
      by the 'org.apache.sis.internal.book.Assembler' class in 'sis-build-helper' module.
    -->
    <section>
      <header>
        <h2 id="ComponentsOfCRS">Components of a reference system by coordinates</h2>
      </header>
      <p>
        Spatial reference systems by coordinates provide necessary information for mapping numerical coordinate values
        to real-world locations. In Apache <abbr>SIS</abbr>, most information is contained (directly or indirectly) in
        classes with a name ending in <abbr>CRS</abbr>, the abbreviation of <i>Coordinate Reference System</i>.
        Those objects contain:
      </p>
      <ul>
        <li>A <i>datum</i>, which specifies among other things which ellipsoid to use as an Earth shape approximation.</li>
        <li>A description for each axis: name, direction, units of measurement, range of values.</li>
        <li>Sometime a list of parameters, especially when using map projections.</li>
      </ul>
      <p>
        Those systems are described by the <abbr>ISO</abbr> 19111 standard (<i>Referencing by Coordinates</i>),
        which replaces for most parts the older <abbr>OGC 01-009</abbr> standard (<i>Coordinate Transformation Services</i>).
        Those standards are completed by two other standards defining exchange formats:
        <abbr>ISO</abbr> 19136 and 19162 respectively for the
        <cite>Geographic Markup Language</cite> (<abbr>GML</abbr>) — a <abbr>XML</abbr> format which is quite detailed but verbose —
        and the <cite>Well-Known Text</cite> (<abbr>WKT</abbr>) — a text format easier to read by humans.
      </p>

      <h3 id="Ellipsoid">Geoid et ellipsoid</h3>
      <p>
        Since the real topographic surface is difficult to represent mathematically, it is not used directly.
        A slightly more convenient surface is the geoid,
        a surface where the gravitational field has the same value everywhere (an equipotential surface).
        This surface is perpendicular to the direction of a plumb line at all points.
        The geoid surface would be equivalent to the mean sea level if all oceans where at rest,
        without winds or permanent currents like the Gulf Stream.
      </p><p>
        While much smoother than topographic surface, the geoid surface still have hollows and bumps
        caused by the uneven distribution of mass inside Earth.
        For more convenient mathematical operations, the geoid surface is approximated by an ellipsoid.
        This “figure of Earth” is represented in GeoAPI by the <code>Ellipsoid</code> interface,
        a fundamental component in coordinate reference systems of kind <code>GeographicCRS</code> and <code>ProjectedCRS</code>.
        Tenth of ellipsoids are commonly used for datum definitions.
        Some of them provide a very good approximation for a particular geographic area
        at the expense of the rest of the world for which the datum was not designed.
        Other datums are compromises applicable to the whole world.
      </p>
      <div class="example">
        <p><b>Example:</b>
        the <abbr>EPSG</abbr> geodetic dataset defines among others the “<abbr>WGS</abbr> 84”, “Clarke 1866”, “Clarke 1880”,
        “<abbr>GRS</abbr> 1980” and “<abbr>GRS</abbr> 1980 Authalic Sphere” (a sphere of same surface than the <abbr>GRS</abbr> 1980 ellipsoid).
        Ellipsoids may be used in various places of the world or may be defined for a very specific region.
        For example in <abbr>USA</abbr> at the beginning of XX<sup>th</sup> century,
        the Michigan state used an ellipsoid based on the “Clarke 1866” ellipsoid but with axis lengths expanded by 800 feet.
        This modification aimed to take in account the average state height above mean sea level.</p>
      </div>

      <h3 id="GeodeticDatum">Geodetic datum</h3>
      <p>
        For defining a geodetic system in a country, a national authority selects an ellipsoid matching closely the country surface.
        Differences between that ellipsoid and the geoid’s hollows and bumps are usually less than 100 metres.
        Parameters that relate an <code>Ellipsoid</code> to the Earth surface (for example the position of ellipsoid center)
        are represented by instances of <code>GeodeticDatum</code>.
        Many <code>GeodeticDatum</code> definitions can use the same <code>Ellipsoid</code>,
        but with different orientations or center positions.
      </p><p>
        Before the satellite era, geodetic measurements were performed exclusively from Earth surface.
        Consequently, two islands or continents not in range of sight from each other were not geodetically related.
        So the <cite>North American Datum 1983</cite> (<abbr>NAD83</abbr>) and the <cite>European Datum 1950</cite> (<abbr>ED50</abbr>)
        are independent: their ellipsoids have different sizes and are centered at a different positions.
        The same geographic coordinate will map different locations on Earth depending on whether the coordinate
        uses one reference system or the other.
      </p><p>
        The <abbr title="Global Positioning System">GPS</abbr> invention implied the creation of a
        world geodetic system named <abbr title="World Geodetic System 1984">WGS84</abbr>.
        The ellipsoid is then unique and centered at the Earth gravity center.
        <abbr>GPS</abbr> provides at any moment the receptor absolute position on that world geodetic system.
        But since <abbr>WGS84</abbr> is a world-wide system, it may differs significantly from local systems.
        For example the difference between <abbr>WGS84</abbr> and the European system <abbr>ED50</abbr> is about 150 metres,
        and the average difference between <abbr>WGS84</abbr> and the <cite>Réunion 1947</cite> system is 1.5 kilometres.
        Consequently we shall not blindly use <abbr>GPS</abbr> coordinates on a map,
        as transformations to the local system may be required.
        Those transformations are represented in GeoAPI by instances of the <code>Transformation</code> interface.
      </p><p>
        The <abbr>WGS84</abbr> ubiquity tends to reduce the need for <code>Transformation</code> operations with recent data,
        but does not eliminate it.
        The Earth moves under the effect of plate tectonic and new systems are defined every years for taking that fact in account.
        For example while <abbr>NAD83</abbr> was originally defined as practically equivalent to <abbr>WGS84</abbr>,
        there is now (as of 2016) a 1.5 metres difference.
        The <cite>Japanese Geodetic Datum 2000</cite> was also defined as practically equivalent to <abbr>WGS84</abbr>,
        but the <cite>Japanese Geodetic Datum 2011</cite> now differs.
        Even the <abbr>WGS84</abbr> datum, which was a terrestrial model realization at a specific time,
        got revisions because of improvements in instruments accuracy.
        Today, at least six <abbr>WGS84</abbr> versions exist.
        Furthermore many borders were legally defined in legacy datums, for example <abbr>NAD27</abbr> in <abbr>USA</abbr>.
        Updating data to the new datum would imply transforming some straight lines or simple geometric shapes
        into more irregular shapes, if the shapes are large enough.
      </p>

      <h3 id="CoordinateSystem">Coordinate systems</h3>
      <p style="color: red">TODO</p>

      <h4 id="AxisOrder">Axis order</h4>
      <p>
        The axis order is specified by the authority (typically a national agency) defining the <cite>Coordinate Reference System</cite> (<abbr>CRS</abbr>).
        The order depends on the <abbr>CRS</abbr> type and the country defining the <abbr>CRS</abbr>.
        In the case of geographic <abbr>CRS</abbr>, the (<var>latitude</var>, <var>longitude</var>) axis order is widely used by geographers and pilots for centuries.
        However software developers tend to consistently use the (<var>x</var>, <var>y</var>) order for every kind of <abbr>CRS</abbr>.
        Those different practices resulted in contradictory definitions of axis order for almost every <abbr>CRS</abbr> of kind <code>GeographicCRS</code>,
        for some <code>ProjectedCRS</code> in the South hemisphere (South Africa, Australia, <i>etc.</i>) and for some polar projections among others.
      </p><p>
        Recent <abbr>OGC</abbr> standards mandate the use of axis order as defined by the authority.
        Oldest <abbr>OGC</abbr> standards used the (<var>x</var>, <var>y</var>) axis order instead, ignoring any authority specification.
        Many software products still use the old (<var>x</var>, <var>y</var>) axis order,
        maybe because such uniformization makes <abbr>CRS</abbr> implementation and usage <em>apparently</em> easier.
        Apache <abbr>SIS</abbr> supports both conventions with the following approach:
        by default, <abbr>SIS</abbr> creates <abbr>CRS</abbr> with axis order <em>as defined by the authority</em>.
        Those <abbr>CRS</abbr> are created by calls to the <code>CRS.forCode(String)</code> method
        and the actual axis order can be verified after the <abbr>CRS</abbr> creation with <code>System.out.println(crs)</code>.
        But if (<var>x</var>, <var>y</var>) axis order is wanted for compatibility with older <abbr>OGC</abbr> specifications or other software products,
        then <abbr>CRS</abbr> forced to <cite>longitude first</cite> axis order can be created by a call to the following method:
      </p>

<pre><code>CoordinateReferenceSystem crs = …;               // CRS obtained by any means.
crs = AbstractCRS.castOrCopy(crs).forConvention(AxesConvention.RIGHT_HANDED)</code></pre>

      <p>
        Among the legacy <abbr>OGC</abbr> standards that used the non-conform axis order,
        an influent one is version 1 of the <cite>Well Known Text</cite> (<abbr>WKT</abbr>) format specification.
        According that widely-used format, <abbr>WKT</abbr> 1 definitions without explicit <code>AXIS[…]</code> elements
        shall default to (<var>longitude</var>, <var>latitude</var>) or (<var>x</var>, <var>y</var>) axis order.
        In version 2 of <abbr>WKT</abbr> format, <code>AXIS[…]</code> elements are no longer optional
        and should contain an explicit <code>ORDER[…]</code> sub-element for making the intended order yet more obvious.
        But if <code>AXIS[…]</code> elements are nevertheless missing in a <abbr>WKT</abbr> 2 definition,
        Apache <abbr>SIS</abbr> defaults to (<var>latitude</var>, <var>longitude</var>) order.
        So in summary:
      </p>
      <ul>
        <li>Default <abbr>WKT</abbr> 1 axis order of geographic <abbr>CRS</abbr> is (<var>longitude</var>, <var>latitude</var>) as mandated by <abbr>OGC</abbr> 01-009 specification.</li>
        <li>Default <abbr>WKT</abbr> 2 axis order of geographic <abbr>CRS</abbr> is (<var>latitude</var>, <var>longitude</var>),
            but this is <abbr>SIS</abbr>-specific as <abbr>ISO</abbr> 19162 does not mention default axis order.</li>
      </ul>
      <p>
        To avoid ambiguities, users are encouraged to always provide explicit <code>AXIS[…]</code> elements in their <abbr>WKT</abbr>.
        The <abbr>WKT</abbr> format will be presented in more details in the next sections.
      </p>

      <h3 id="GeographicCRS">Geographic reference systems</h3>
      <p style="color: red">TODO</p>

      <h4 id="GeographicWKT"><i>Well-Known Text</i> format</h4>
      <p style="color: red">TODO</p>

      <h3 id="ProjectedCRS">Map projections</h3>
      <p>
        Map projections represent a curved surface (the Earth) on a plane surface (a map or a computer screen)
        with some control over deformations: one can preserve either the angles or the areas, but not both in same time.
        The geometric properties to preserve depend on the feature to represent and the work to do on that feature.
        For example countries elongated along the East-West axis often use a Lambert projection,
        while countries elongated along the North-South axis prefer a Transverse Mercator projection.
      </p>
      <p style="color: red">TODO</p>

      <h4 id="ProjectedWKT"><i>Well-Known Text</i> format</h4>
      <p style="color: red">TODO</p>

      <h3 id="CompoundCRS">Vertical and temporal dimensions</h3>
      <p style="color: red">TODO</p>

      <h4 id="CompoundWKT"><i>Well-Known Text</i> format</h4>
      <p style="color: red">TODO</p>
    </section>
  </body>
</html>
