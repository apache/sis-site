<!DOCTYPE html>
<html lang="en">
<head>
  

  <title>Apache SIS - Release management setup</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="http://www.apache.org/css/code.css">
  <link rel="stylesheet" type="text/css" media="screen" href="css/syntax.css">
  <link rel="stylesheet" type="text/css" media="screen" href="css/sis.css">
</head>

<body>

<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="/index.html"> Apache SIS&trade;</a>
      <div class="nav-collapse">
        <ul class="nav">
          <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="http://www.apache.org/licenses/">License</a></li>
              <li><a href="mail-lists.html">Mailing Lists</a></li>
              <li><a href="team-list.html">Project Team</a></li>
            </ul>
          </li>
          <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation<b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="book/index.html">Developer Guide</a></li>
              <li><a href="apidocs/index.html">Online Javadoc</a></li>
              <li><a href="downloads.html">Downloads</a></li>
              <li><a href="source.html">Checkout Sources</a></li>
              <li><a href="epsg.html">EPSG Database</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
            </ul>
          </li>
          <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="http://www.apache.org">The Foundation</a></li>
              <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
              <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="http://www.apache.org/security/">Security</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>


<div class="container-fluid">
  <div class="row-fluid">
    <div class="span2">
      <div class="apache-con">
        <a href="https://www.apache.org/events/current-event.html">
          <img src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
        </a>
      </div>
      <div class="well sidebar-nav">
        <ul class="nav nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="http://www.apache.org/licenses/">License</a></li>
          <li><a href="mail-lists.html">Mailing Lists</a></li>
          <li><a href="team-list.html">Project Team</a></li>
          <li class="nav-header">Project Documentation</li>
          <li><a href="book/index.html">Developer Guide</a></li>
          <li><a href="apidocs/index.html">Online Javadoc</a></li>
          <li><a href="downloads.html">Downloads</a></li>
          <li><a href="source.html">Checkout Sources</a></li>
          <li><a href="epsg.html">EPSG Database</a></li>
          <li><a href="faq.html">FAQ</a></li>
          <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
          <li class="nav-header">ASF</li>
          <li><a href="http://www.apache.org">The Foundation</a></li>
          <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
          <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
          <li><a href="http://www.apache.org/security/">Security</a></li>
        </ul>
      </div>
    </div>
    <div class="span10">
      <section id="content" class="row">
        <article class="span12">
          <img src="img/logo.png" class="sis-logo" align="left"/>
          <p class="page-title">Release management setup</p>
          
          <style type="text/css">
               
               
              .headerlink, .elementid-permalink {
                  visibility: hidden;
              }
              h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }
          </style>
          
	<p>The following instructions need to be done only once by new release managers,
or when configuring a new machine for performing the releases.
If those steps have already been done, jump directly to the <a href="release-management.html">Release Management</a> page.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#directory-layout">Directory layout   </a></li>
    <li><a href="#generate-key">Generate GPG key   </a>
      <ul>
        <li><a href="#trust">Web of trust   </a></li>
      </ul>
    </li>
    <li><a href="#maven">Maven Configuration &amp; Nexus Setup   </a></li>
  </ul>
</nav>
<h1 id="directory-layout">Directory layout   </h1>
<p>The steps described in the <em>release management</em> page assume the following directory layout.
Some directories are Git checkout, other are ordinary directories. Any other layout can be used.
However in the later case, all relative paths in the <em>release management</em> page will need to be adjusted accordingly.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">&lt;any root directory for SIS&gt;
├─ master
├─ non-free
│  ├─ sis-epsg
│  └─ sis-embedded-data
├─ releases
│  ├─ distribution
│  └─ integration-test
│     └─ maven
└─ site</code></pre></div>
<p>Create the above directory structure as below:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mkdir releases
git clone    https://gitbox.apache.org/repos/asf/sis.git master
svn checkout https://svn.apache.org/repos/asf/sis/data/non-free
svn checkout https://svn.apache.org/repos/asf/sis/site/trunk site
svn checkout https://svn.apache.org/repos/asf/sis/release-test releases/integration-test
svn checkout https://dist.apache.org/repos/dist/dev/sis releases/distribution</code></pre></div>
<h1 id="generate-key">Generate GPG key   </h1>
<p>The releases have to be signed by public key cryptography signatures.
Detailed instructions about why releases have to be signed are provided on the <a href="http://www.apache.org/dev/release-signing.html">Release Signing</a> page.
The standard used is OpenPGP (<em>Open Pretty Good Privacy</em>), and a popular software implementation of that standard is GPG (<em>GNU Privacy Guard</em>).
The <a href="http://www.apache.org/dev/openpgp.html">OpenPGP instructions</a> list out detailed steps on managing your keys.
The following steps provide a summary:</p>
<p>Edit the <code>~/.gnupg/gpg.conf</code> configuration file and add the following configuration options,
or edit the existing values if any:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">personal-digest-preferences SHA512
cert-digest-algo SHA512
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed</code></pre></div>
<p>If a private key already exists for emails or other purposes, it may be a good idea to keep that key as the default one.
Add or modify the following line in the <code>gpg.conf</code> file, replacing <code>&lt;previous_key_id&gt;</code> by the existing key identifier
(a value like <code>621CC013</code>):</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">default-key &lt;previous_key_id&gt;</code></pre></div>
<p>Generate 4096 bits RSA key pair using the following command-line. GPG will prompts for various informations.
The list below the command suggests some values, keeping in mind that the new key should be used only for
signing Apache software packages - not for daily emails.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg --gen-key</code></pre></div>
<ul>
<li>Kind of key: RSA and RSA (default). Do not create DSA key.</li>
<li>Key size: 4096 bits.</li>
<li>Validity time: 0 (key does not expire).</li>
<li>Real name: the developer&rsquo;s name.</li>
<li>Email address: developer&rsquo;s email address at <code>@apache.org</code>.</li>
<li>Comment: &ldquo;CODE SIGNING KEY&rdquo;.</li>
<li>Passphrase: please choose a strong one.</li>
</ul>
<p>Verify the key information (replace <em>Real Name</em> by the above-cited developer&rsquo;s name, keeping quotes in the command below).
Note the key identifier, which is a value like <code>74383E9D</code>. This key identifier will be needed for the next steps.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg --list-sigs <span class="s2">&#34;Real Name&#34;</span></code></pre></div>
<p>Sends the public key to a keys server (replace <code>&lt;key_id&gt;</code> by the above-cited key identifier).
The default GPG configuration sends the key to <code>hkp://keys.gnupg.net</code>.
Note that while there is many key servers, most of them synchronize changes with each other,
so a key uploaded to one should be disseminated to the rest.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg --send-key &lt;key_id&gt;</code></pre></div>
<p>The key publication can be verified by going on the <a href="http://pgp.mit.edu">MIT server</a>,
then entering the developer&rsquo;s &ldquo;Real Name&rdquo; in the <em>Search String</em> field.
It may take a few hours before the published key is propagated.</p>
<p>Generate a revocation certificate. This is not for immediate use, but generating the certificate now
is a safety in case the passphrase is lost. Keep the revocation certificate in a safe place,
preferably on a removable device.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg --output revocation_certificate.asc --gen-revoke &lt;key_id&gt;</code></pre></div>
<h2 id="trust">Web of trust   </h2>
<p>Have the key signed by at least three Apache commiters. This can be done by executing the following commands on
the machine of the other Apache commiter, where <code>&lt;key_to_use&gt;</code> is the identifier of the other commiter&rsquo;s key.
Those operation should preferably be done in some event where the commiters can meet face-to-face.
The other commiter should verify that the <code>gpg --fingerprint</code> command output matches the fingerprint of the key to sign.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg --recv-keys &lt;key_id&gt;
gpg --fingerprint &lt;key_id&gt;
gpg --default-key &lt;key_to_use&gt; --sign-key &lt;key_id&gt;
gpg --send-key &lt;key_id&gt;</code></pre></div>
<p>The above-cited <em>Release Signing</em> page provides more instructions.
Then, the signed public key shall be appended to the <code>KEYS</code> file on the <a href="https://gitbox.apache.org/repos/asf?p=sis.git">SIS source code repository</a>,
then copied to the <a href="http://dist.apache.org/repos/dist/release/sis/">SIS distribution directory</a>.</p>
<h1 id="maven">Maven Configuration &amp; Nexus Setup   </h1>
<p>Detailed instructions are at <a href="http://www.apache.org/dev/publishing-maven-artifacts.html">Publishing Maven Artifacts</a>.
In summary, the developer needs to specify his Apache username and password (<strong>not</strong> the PGP passphrase)
in his local <code>~/.m2</code> directory, and the GPG key identifier.
First, if not already done, create a Maven master password:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mvn --encrypt-master-password &lt;password&gt;</code></pre></div>
<p>The command will produce an encrypted version of the given password, something like <code>{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}</code>.
Store this password in the <code>~/.m2/settings-security.xml</code> file like below:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;settingsSecurity&gt;</span>
  <span class="nt">&lt;master&gt;</span>{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}<span class="nt">&lt;/master&gt;</span>
<span class="nt">&lt;/settingsSecurity&gt;</span></code></pre></div>
<p>Then encrypt the Apache account password (<strong>not</strong> the PGP passphrase) like below:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mvn --encrypt-password &lt;passphrase&gt;</code></pre></div>
<p>The command will produce an encrypted version of the password, something like <code>{COQLCE6DU6GtcS5P=}</code>.
Cut-and-paste it in a section of the <code>~/.m2/settings.xml</code> file like below,
together with the PGP key name:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;settings&gt;</span>
...
  <span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;id&gt;</span>apache.releases.https<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;username&gt;</span> <span class="c">&lt;!-- your Apache username --&gt;</span> <span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>{COQLCE6DU6GtcS5P=}<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
   ...
  <span class="nt">&lt;/servers&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>apache-release<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;user.name&gt;</span> <span class="c">&lt;!-- your Apache username --&gt;</span> <span class="nt">&lt;/user.name&gt;</span>
        <span class="nt">&lt;gpg.keyname&gt;</span> <span class="c">&lt;!-- the identifier of the GPG key generated in above steps --&gt;</span> <span class="nt">&lt;/gpg.keyname&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></div>
<p>Notes:</p>
<ul>
<li>Do not store the PGP passphrase in the <code>settings.xml</code> file.
We will use the <code>gpg-agent</code> instead, as described in the <a href="release-management.html">release management</a> page.</li>
<li>In the <code>&lt;profile&gt;</code> section:
<ul>
<li>The <code>&lt;user.name&gt;</code> property can be omitted if the Apache user name matches the user name on the local operating system.</li>
<li>The <code>&lt;gpg.keyname&gt;</code> property can be omitted if GPG contains only one private key.</li>
<li>The whole <code>&lt;profile&gt;</code> section can be omitted if the two above-cited properties are omitted.</li>
</ul>
</li>
</ul>


        </article>
      </section>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>
      Copyright &copy; 2013-2021 The Apache Software Foundation, Licensed under the
      <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
      Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.
    </p>
  </div>
</footer>

<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">
const pathname = window.location.pathname
const current_path = pathname.substring(1, pathname.length)
const link = $('a[href="' + current_path + '"]')
if (link !== undefined) {
  link.parents('li,ul').addClass('active')
}
</script>

</body>
</html>
