<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Release management setup</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="http://www.apache.org/css/code.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/sis.css">

    

    
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License.  You may obtain a copy of the License at . http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the specific language governing permissions and limitations under the License. -->
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/index.html"> Apache SIS&trade;</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org/licenses/">License</a></li>
                  <li><a href="mail-lists.html">Mailing Lists</a></li>
                  <li><a href="team-list.html">Project Team</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="book/index.html">Developer guide</a></li>
                  <li><a href="apidocs/index.html">Online Javadoc</a></li>
                  <li><a href="downloads.html">Downloads</a></li>
                  <li><a href="source.html">Source Code</a></li>
                  <li><a href="code-patterns.html">Code patterns</a></li>
                  <li><a href="faq.html">FAQ</a></li>
                  <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
                </ul>
              </li>
              <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.apache.org">The Foundation</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>
            </ul>
          </div><!-- /.nav-collapse -->
        </div><!-- /.container -->
      </div><!-- /.navbar-inner -->
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <div class="apache-con">
            <a href="https://www.apache.org/events/current-event.html">
              <img src="https://www.apache.org/events/current-event-234x60.png" alt="ApacheCon"/>
            </a>
          </div>
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li><a href="index.html">Home</a></li>
              <li><a href="http://www.apache.org/licenses/">License</a></li>
              <li><a href="mail-lists.html">Mailing Lists</a></li>
              <li><a href="team-list.html">Project Team</a></li>
              <li class="nav-header">Project Documentation</li>
              <li><a href="book/index.html">Developer guide</a></li>
              <li><a href="apidocs/index.html">Online Javadoc</a></li>
              <li><a href="downloads.html">Downloads</a></li>
              <li><a href="source.html">Source Code</a></li>
              <li><a href="code-patterns.html">Code patterns</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="https://issues.apache.org/jira/browse/SIS">Issue Tracker</a></li>
              <li class="nav-header">ASF</li>
              <li><a href="http://www.apache.org">The Foundation</a></li>
              <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
              <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="http://www.apache.org/security/">Security</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span10">
          <section id="content" class="row">
            <article class="span12">
              <img src="img/logo.png" class="sis-logo" align="left"/>
              <p class="page-title">Release management setup</p>
              <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>The following instructions need to be done only once by new release managers,
or when configuring a new machine for performing the releases.
If those steps have already been done, jump directly to the <a href="release-management.html">Release Management</a> page.</p>
<div class="toc">
<ul>
<li><a href="#directory-layout">Directory layout</a></li>
<li><a href="#shell">Shell configuration</a></li>
<li><a href="#generate-key">Generate GPG key</a><ul>
<li><a href="#trust">Web of trust</a></li>
</ul>
</li>
<li><a href="#maven">Maven Configuration &amp; Nexus Setup</a></li>
</ul>
</div>
<h1 id="directory-layout">Directory layout<a class="headerlink" href="#directory-layout" title="Permanent link">&para;</a></h1>
<p>The steps described in the <em>release management</em> page assume the following directory layout.
Some directories are SVN checkout, other are ordinary directories. Any other layout can be used.
However in the later case, all relative paths in the <em>release management</em> page will need to be adjusted accordingly.</p>
<div class="codehilite"><pre>&lt;any root directory for SIS&gt;
├─ trunk
├─ branches
├─ tags
├─ non-free
│  ├─ sis-epsg
│  └─ sis-embedded-data
├─ distribution
├─ release-test
│  └─ maven
└─ site
</pre></div>


<p>Create the above directory structure as below:</p>
<div class="codehilite"><pre>svn checkout https://svn.apache.org/repos/asf/sis/trunk
svn checkout https://svn.apache.org/repos/asf/sis/data/non-free
svn checkout https://svn.apache.org/repos/asf/sis/release-test
svn checkout https://svn.apache.org/repos/asf/sis/site/trunk site
svn checkout https://dist.apache.org/repos/dist/dev/sis distribution
mkdir branches
mkdir tags
</pre></div>


<h1 id="shell">Shell configuration<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h1>
<p>It is better for Unix shells to contain the following line in their initialization file
(typically <code>~/.bashrc</code> or <code>~/.profile</code>, where <code>~</code> stands for the user's home directory):</p>
<div class="codehilite"><pre><span class="nb">export </span><span class="nv">GPG_TTY</span><span class="o">=</span><span class="k">$(</span>tty<span class="k">)</span>
</pre></div>


<h1 id="generate-key">Generate GPG key<a class="headerlink" href="#generate-key" title="Permanent link">&para;</a></h1>
<p>The releases have to be signed by public key cryptography signatures.
Detailed instructions about why releases have to be signed are provided on the <a href="http://www.apache.org/dev/release-signing.html">Release Signing</a> page.
The standard used is OpenPGP (<em>Open Pretty Good Privacy</em>), and a popular software implementation of that standard is GPG (<em>GNU Privacy Guard</em>).
The <a href="http://www.apache.org/dev/openpgp.html">OpenPGP instructions</a> list out detailed steps on managing your keys.
The following steps provide a summary:</p>
<p>Edit the <code>~/.gnupg/gpg.conf</code> configuration file and add the following configuration options,
or edit the existing values if any:</p>
<div class="codehilite"><pre>personal-digest-preferences SHA512
cert-digest-algo SHA512
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed
</pre></div>


<p>If a private key already exists for emails or other purposes, it may be a good idea to keep that key as the default one.
Add or modify the following line in the <code>gpg.conf</code> file, replacing <code>&lt;previous_key_id&gt;</code> by the existing key identifier
(a value like <code>621CC013</code>):</p>
<div class="codehilite"><pre>default-key &lt;previous_key_id&gt;
</pre></div>


<p>Generate 4096 bits RSA key pair using the following command-line. GPG will prompts for various informations.
The list below the command suggests some values, keeping in mind that the new key should be used only for
signing Apache software packages - not for daily emails.</p>
<div class="codehilite"><pre>gpg --gen-key
</pre></div>


<ul>
<li>Kind of key: RSA and RSA (default). Do not create DSA key.</li>
<li>Key size: 4096 bits.</li>
<li>Validity time: 0 (key does not expire).</li>
<li>Real name: the developer's name.</li>
<li>Email address: developer's email address at <code>@apache.org</code>.</li>
<li>Comment: "CODE SIGNING KEY".</li>
<li>Passphrase: please choose a strong one.</li>
</ul>
<p>Verify the key information (replace <em>Real Name</em> by the above-cited developer's name, keeping quotes in the command below).
Note the key identifier, which is a value like <code>74383E9D</code>. This key identifier will be needed for the next steps.</p>
<div class="codehilite"><pre>gpg --list-sigs <span class="s2">&quot;Real Name&quot;</span>
</pre></div>


<p>Sends the public key to a keys server (replace <code>&lt;key_id&gt;</code> by the above-cited key identifier).
The default GPG configuration sends the key to <code>hkp://keys.gnupg.net</code>.
Note that while there is many key servers, most of them synchronize changes with each other,
so a key uploaded to one should be disseminated to the rest.</p>
<div class="codehilite"><pre>gpg --send-key &lt;key_id&gt;
</pre></div>


<p>The key publication can be verified by going on the <a href="http://pgp.mit.edu">MIT server</a>,
then entering the developer's "Real Name" in the <em>Search String</em> field.
It may take a few hours before the published key is propagated.</p>
<p>Generate a revocation certificate. This is not for immediate use, but generating the certificate now
is a safety in case the passphrase is lost. Keep the revocation certificate in a safe place,
preferably on a removable device.</p>
<div class="codehilite"><pre>gpg --output revocation_certificate.asc --gen-revoke &lt;key_id&gt;
</pre></div>


<h2 id="trust">Web of trust<a class="headerlink" href="#trust" title="Permanent link">&para;</a></h2>
<p>Have the key signed by at least three Apache commiters. This can be done by executing the following commands on
the machine of the other Apache commiter, where <code>&lt;key_to_use&gt;</code> is the identifier of the other commiter's key.
Those operation should preferably be done in some event where the commiters can meet face-to-face.
The other commiter should verify that the <code>gpg --fingerprint</code> command output matches the fingerprint of the key to sign.</p>
<div class="codehilite"><pre>gpg --recv-keys &lt;key_id&gt;
gpg --fingerprint &lt;key_id&gt;
gpg --default-key &lt;key_to_use&gt; --sign-key &lt;key_id&gt;
gpg --send-key &lt;key_id&gt;
</pre></div>


<p>The above-cited <em>Release Signing</em> page provides more instructions.
Then, the signed public key shall be appended to the <code>KEYS</code> file on the <a href="https://svn.apache.org/repos/asf/sis/trunk/">SIS source code repository</a>,
then copied to the <a href="http://dist.apache.org/repos/dist/release/sis/">SIS distribution directory</a>.</p>
<h1 id="maven">Maven Configuration &amp; Nexus Setup<a class="headerlink" href="#maven" title="Permanent link">&para;</a></h1>
<p>Detailed instructions are at <a href="http://www.apache.org/dev/publishing-maven-artifacts.html">Publishing Maven Artifacts</a>.
In summary, the developer needs to specify his Apache username and password (<strong>not</strong> the PGP passphrase)
in his local <code>~/.m2</code> directory, and the GPG key identifier.
First, if not already done, create a Maven master password:</p>
<div class="codehilite"><pre>mvn --encrypt-master-password &lt;password&gt;
</pre></div>


<p>The command will produce an encrypted version of the given password, something like <code>{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}</code>.
Store this password in the <code>~/.m2/settings-security.xml</code> file like below:</p>
<div class="codehilite"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;settingsSecurity&gt;</span>
  <span class="nt">&lt;master&gt;</span>{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}<span class="nt">&lt;/master&gt;</span>
<span class="nt">&lt;/settingsSecurity&gt;</span>
</pre></div>


<p>Then encrypt the Apache account password (<strong>not</strong> the PGP passphrase) like below:</p>
<div class="codehilite"><pre>mvn --encrypt-password &lt;passphrase&gt;
</pre></div>


<p>The command will produce an encrypted version of the password, something like <code>{COQLCE6DU6GtcS5P=}</code>.
Cut-and-paste it in a section of the <code>~/.m2/settings.xml</code> file like below,
together with the PGP key name:</p>
<div class="codehilite"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;settings&gt;</span>
...
  <span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;id&gt;</span>apache.releases.https<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;username&gt;</span> <span class="c">&lt;!-- your Apache username --&gt;</span> <span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>{COQLCE6DU6GtcS5P=}<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
   ...
  <span class="nt">&lt;/servers&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>apache-release<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;user.name&gt;</span> <span class="c">&lt;!-- your Apache username --&gt;</span> <span class="nt">&lt;/user.name&gt;</span>
        <span class="nt">&lt;gpg.keyname&gt;</span> <span class="c">&lt;!-- the identifier of the GPG key generated in above steps --&gt;</span> <span class="nt">&lt;/gpg.keyname&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</pre></div>


<p>Notes:</p>
<ul>
<li>Do not store the PGP passphrase in the <code>settings.xml</code> file.
    We will use the <code>gpg-agent</code> instead, as described in the <a href="release-management.html">release management</a> page.</li>
<li>In the <code>&lt;profile&gt;</code> section:<ul>
<li>The <code>&lt;user.name&gt;</code> property can be omitted if the Apache user name matches the user name on the local operating system.</li>
<li>The <code>&lt;gpg.keyname&gt;</code> property can be omitted if GPG contains only one private key.</li>
<li>The whole <code>&lt;profile&gt;</code> section can be omitted if the two above-cited properties are omitted.</li>
</ul>
</li>
</ul>
            </article>
          </section>
        </div><!--/span-->
      </div><!--/row-fluid-->
    </div><!--/container-fluid-->

  <footer class="footer">
    <div class="container">
      <p>Copyright &copy; 2013-2018 The Apache Software Foundation, Licensed under the
        <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br />
          Apache SIS, Apache, the Apache feather logo are trademarks of The Apache Software Foundation.</p>
    </div>
  </footer>

  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <!-- for marking links as active in the navbar-menu -->
  <script type="text/javascript">
    var pathname = this.location.pathname;
    pathname = pathname.substring(1, pathname.length);
    var link = $('a[href="' + pathname + '"]');
    if (link != undefined)
      link.parents('li,ul').addClass('active');
  </script>

</body>
</html>
